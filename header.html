<header class="header-nav notranslate">
  <div class="nav-container">

    <!-- Logo -->
    <a href="./index.html" class="logo-nav">
      <img src="logo-gabarit-kdp-site-web.png" alt="GabaritKDP Logo">
      <span>GabaritKDP</span>
    </a>

    <!-- Menu Hamburger - Mobile -->
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Language Selector -->
    <div class="language-selector">
      <button class="lang-btn" data-lang="fr" onclick="switchLanguage('fr')">FR</button>
      <button class="lang-btn active" data-lang="en" onclick="switchLanguage('en')">US</button>
    </div>

    <!-- Navigation Desktop -->
    <nav class="nav-links">
      <a href="./index.html" data-fr="ğŸ  Accueil" data-en="ğŸ  Home">ğŸ  Home</a>

      <a href="./dashboard.html"
         data-fr="ğŸ“Š Tableau de bord"
         data-en="ğŸ“Š Dashboard">ğŸ“Š Dashboard</a>

      <a href="./generator.html"
   class="express-nav-btn"
   data-fr="âš¡ GÃ©nÃ©rateur Express"
   data-en="âš¡ Express Generator">
   Express Generator
</a>

      <a href="./generator-magic.html"
         data-fr="ğŸª„ GÃ©nÃ©rateur Magique"
         data-en="ğŸª„ Magic Generator">ğŸª„ Magic Generator</a>

      <a href="./marketplace.html"
         data-fr="ğŸ“š Templates"
         data-en="ğŸ“š Templates">ğŸ“š Templates</a>

      <a href="./inscription.html"
         data-fr="ğŸ“ Inscription"
         data-en="ğŸ“ Sign Up">ğŸ“ Sign Up</a>

      <a href="./connexion.html" id="nav-login-btn"
         data-fr="ğŸ” Connexion"
         data-en="ğŸ” Login">ğŸ” Login</a>
      <a href="#" id="nav-logout-btn" onclick="headerSignOut(event)"
         style="display:none; color:#ef4444 !important;"
         data-fr="ğŸšª DÃ©connexion"
         data-en="ğŸšª Logout">ğŸšª Logout</a>
    </nav>
  </div>

  <!-- Menu Mobile -->
  <div class="mobile-menu" id="mobileMenu">
    <button class="mobile-menu-close" onclick="toggleMobileMenu()">
      <i class="fas fa-times"></i>
    </button>

    <div class="mobile-menu-links">
      <a href="./index.html" data-fr="ğŸ  Accueil" data-en="ğŸ  Home">ğŸ  Home</a>
      <a href="./dashboard.html" data-fr="ğŸ“Š Tableau de bord" data-en="ğŸ“Š Dashboard">ğŸ“Š Dashboard</a>
      <a href="./generator.html" data-fr="GÃ©nÃ©rateur Express" data-en="Express Generator">Express Generator</a>
      <a href="./generator-magic.html" data-fr="ğŸª„ GÃ©nÃ©rateur Magique" data-en="ğŸª„ Magic Generator">ğŸª„ Magic Generator</a>
      <a href="./marketplace.html" data-fr="ğŸ“š Templates" data-en="ğŸ“š Templates">ğŸ“š Templates</a>
      <a href="./inscription.html" data-fr="ğŸ“ Inscription" data-en="ğŸ“ Sign Up">ğŸ“ Sign Up</a>
      <a href="./connexion.html" id="mob-login-btn" data-fr="ğŸ” Connexion" data-en="ğŸ” Login">ğŸ” Login</a>
      <a href="#" id="mob-logout-btn" onclick="headerSignOut(event)"
         style="display:none; background:rgba(239,68,68,.2) !important; border-color:#ef4444 !important; color:#ef4444 !important;"
         data-fr="ğŸšª DÃ©connexion"
         data-en="ğŸšª Logout">ğŸšª Logout</a>
    </div>
  </div>
  <style>
  /* Safety defaults: desktop shows nav-links; mobile menu hidden */
  .mobile-menu { display: none; }
  .mobile-menu-toggle { display: none; }

  /* Mobile breakpoint */
  @media (max-width: 768px) {
    .nav-links { display: none !important; }
    .mobile-menu-toggle { display: inline-flex !important; }
  }

  /* When opened via JS */
  .mobile-menu.open { display: block; }
</style>

<script>
  function toggleMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    if (!menu) return;
    menu.classList.toggle('open');
  }
</script>


<script>
  // Auth state dans le header
  (function() {
    const SUPABASE_URL = 'https://kucwdaicplajljpfkzhu.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt1Y3dkYWljcGxhamxqcGZremh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5MzMxMjQsImV4cCI6MjA3NzUwOTEyNH0.0IDHysD84_0ghjb-a4K0UkNrJbzdQBKUjm5mQbSfro8';

    function waitForSupabase(cb, tries = 0) {
      if (window.supabase && window.supabase.createClient) {
        cb(window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY));
      } else if (tries < 30) {
        setTimeout(() => waitForSupabase(cb, tries + 1), 100);
      }
    }

    function updateHeaderAuth(isLoggedIn) {
      const loginDesktop  = document.getElementById('nav-login-btn');
      const logoutDesktop = document.getElementById('nav-logout-btn');
      const loginMobile   = document.getElementById('mob-login-btn');
      const logoutMobile  = document.getElementById('mob-logout-btn');

      if (loginDesktop)  loginDesktop.style.display  = isLoggedIn ? 'none' : '';
      if (logoutDesktop) logoutDesktop.style.display = isLoggedIn ? '' : 'none';
      if (loginMobile)   loginMobile.style.display   = isLoggedIn ? 'none' : '';
      if (logoutMobile)  logoutMobile.style.display  = isLoggedIn ? '' : 'none';
    }

    waitForSupabase(function(sb) {
      sb.auth.getSession().then(({ data }) => {
        updateHeaderAuth(!!data.session);
      });
      sb.auth.onAuthStateChange((_event, session) => {
        updateHeaderAuth(!!session);
      });
      window._headerSbClient = sb;
    });
  })();

  async function headerSignOut(e) {
    e.preventDefault();
    if (window._headerSbClient) {
      await window._headerSbClient.auth.signOut();
    } else {
      localStorage.clear();
    }
    window.location.href = './connexion.html';
  }
</script>

</header>
