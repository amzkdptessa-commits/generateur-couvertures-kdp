<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marketplace - GabaritKDP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; background-color: #fff;}
    .header-nav{background:#1e293b; padding:8px 0; position:sticky; top:0; z-index:999; box-shadow:0 2px 10px rgba(0,0,0,0.1)}
    .nav-container{max-width:1400px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; padding:0 20px}
    .logo-nav{display:flex; align-items:center; gap:10px; text-decoration:none; color:#fff}
    .logo-nav img{height:28px;}
    .logo-nav span{font-size:1rem; font-weight:700; color:#FF9900}
    .nav-links a{color:#fff; text-decoration:none; font-weight:500; padding:6px 10px; border-radius:8px; font-size:.8rem}
    .express-nav-btn{background:#10b981!important; color:#fff!important; font-weight:700!important}
    .language-selector{background:#fff; border-radius:20px; padding:2px; display:flex; gap:2px}
    .lang-btn{padding:2px 8px; border:none; background:transparent; border-radius:15px; cursor:pointer; font-weight:bold; font-size:.6rem; color:#1e293b}
    .lang-btn.active{background:#FF9900; color:#fff}
    .premium-bg { background:linear-gradient(135deg,#1e293b 0%,#334155 100%); padding: 40px 0; }
    .category-card{ position:relative; border-radius:12px; overflow:hidden; aspect-ratio:4/3; cursor:pointer; transition:0.3s; box-shadow:0 4px 15px rgba(0,0,0,0.2); background:#2d3748 }
    .category-card:hover{ transform:translateY(-5px); }
    .category-card img{ width:100%; height:100%; object-fit:cover; }
    .category-overlay{ position:absolute; inset:0; background:linear-gradient(to top, rgba(0,0,0,0.85) 0%, transparent 60%); display:flex; flex-direction:column; justify-content:flex-end; padding:1rem; pointer-events:none }
    .category-name{ font-size:0.9rem; font-weight:700; color:#fff; text-transform: uppercase; }
    .category-badge{ position:absolute; top:0.8rem; right:0.8rem; padding:.2rem .6rem; border-radius:9999px; font-size:.55rem; font-weight:800; color:#fff; }
    footer{background:#0f172a; color:#94a3b8; padding:30px 20px 15px; font-size: 0.8rem;}
    .social-links{display:flex; justify-content:center; gap:10px; margin-top:10px}
    .social-link{width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-size:0.9rem; transition:.3s}
    .youtube{background:#FF0000} .facebook{background:#1877F2} .instagram{background:#E4405F}
    @media (max-width: 1024px) { .nav-links { display: none; } }
  </style>
</head>
<body>

  <header class="header-nav notranslate">
    <div class="nav-container">
      <a href="./index.html" class="logo-nav"><img src="logo-gabarit-kdp-site-web.png"><span>GabaritKDP</span></a>
      <nav class="nav-links">
        <a href="./index.html" data-fr="üè† Accueil" data-en="üè† Home">üè† Home</a>
        <a href="./dashboard.html" data-fr="üìä Dashboard" data-en="üìä Dashboard">üìä Dashboard</a>
        <a href="./generator.html" class="express-nav-btn" data-fr="G√©n√©rateur Express" data-en="Express Generator">Express Generator</a>
        <a href="./generator-magic.html" data-fr="G√©n√©rateur Magique" data-en="Magic Generator">Magic Generator</a>
        <a href="./marketplace.html" class="active">Marketplace</a>
        <a href="./inscription.html" data-fr="üìù Inscription" data-en="üìù Sign Up">üìù Sign Up</a>
        <a href="./connexion.html" data-fr="üîì Connexion" data-en="üîì Login">üîì Login</a>
      </nav>
      <div class="language-selector">
        <button class="lang-btn" data-lang="fr" onclick="switchLanguage('fr')">FR</button>
        <button class="lang-btn active" data-lang="en" onclick="switchLanguage('en')">US</button>
      </div>
    </div>
  </header>

  <section class="py-10 bg-slate-50 text-center border-b">
    <h1 class="text-3xl font-black">Marketplace <span style="color:#FF9900;">KDP</span></h1>
    <p class="text-gray-500">6600+ templates synchronized automatically from your PC.</p>
  </section>

  <!-- SECTION 1: PREMIUM -->
  <section class="premium-bg">
    <div class="max-w-7xl mx-auto px-4">
      <h2 class="text-xl font-bold text-white text-center mb-8 tracking-widest uppercase">üî• Premium Edition</h2>
      <div id="grid-premium" class="grid grid-cols-2 md:grid-cols-4 gap-6"></div>
    </div>
  </section>

  <!-- SECTION 2: COVERS -->
  <section class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4">
      <h2 class="text-xl font-bold text-center mb-8 uppercase tracking-widest text-slate-800">üìö Book Covers</h2>
      <div id="grid-covers" class="grid grid-cols-2 md:grid-cols-4 gap-6"></div>
    </div>
  </section>

  <!-- SECTION 3: INTERIORS -->
  <section class="py-16 bg-slate-50">
    <div class="max-w-7xl mx-auto px-4">
      <h2 class="text-xl font-bold text-center mb-8 uppercase tracking-widest text-slate-800">üìñ Book Interiors</h2>
      <div id="grid-interiors" class="grid grid-cols-1 md:grid-cols-2 max-w-2xl mx-auto gap-8"></div>
    </div>
  </section>

  <footer>
    <div class="max-w-6xl mx-auto text-center">
      <div class="social-links">
        <a href="#" class="social-link youtube"><i class="fab fa-youtube"></i></a>
        <a href="#" class="social-link facebook"><i class="fab fa-facebook-f"></i></a>
        <a href="#" class="social-link instagram"><i class="fab fa-instagram"></i></a>
      </div>
      <p class="mt-4 opacity-40">&copy; 2025 GabaritKDP. All rights reserved.</p>
    </div>
  </footer>

  <script>
    const data = {
      premium: [
        { n: "Art", p: "FULL COVER/Art" },
        { n: "Boheme", p: "FULL COVER/Boheme" },
        { n: "Fantasy", p: "FULL COVER/FANTASY" },
        { n: "Fleurs", p: "FULL COVER/Fleurs" },
        { n: "Historical", p: "FULL COVER/Historical/Historical" },
        { n: "Horror", p: "FULL COVER/Horror/Horror" },
        { n: "Mystery", p: "FULL COVER/Mystery/Mystery" },
        { n: "Religions", p: "FULL COVER/RELIGIONS" },
        { n: "Romance", p: "FULL COVER/Romance" },
        { n: "Sci-Fi", p: "FULL COVER/Sci-fi/Sci-fi" },
        { n: "Thriller", p: "FULL COVER/Thriller/Thriller" },
        { n: "Voyages", p: "FULL COVER/Voyages/MARRAKECH" }
      ],
      covers: [
        { n: "Romance", p: "backgrounds/ROMANCE" },
        { n: "Thriller", p: "backgrounds/THRILLER" },
        { n: "Fantasy", p: "backgrounds/FANTASY" },
        { n: "Mystery", p: "backgrounds/MYSTERY" },
        { n: "Historical", p: "backgrounds/HISTORICAL" },
        { n: "Business", p: "backgrounds/BUSINESS" }
      ],
      interiors: [
        { n: "Planners", u: "category-planners.html", i: "https://gabaritkdp.b-cdn.net/UI/book-interiors/Vignettes%20PLANNERS%202026.png" },
        { n: "Coloring Books", u: "category-coloriages.html", i: "https://gabaritkdp.b-cdn.net/UI/book-interiors/Vignette%20COLORING%20BOOKS.png" }
      ]
    };

    async function renderSection(items, gridId, isInt = false) {
      const grid = document.getElementById(gridId);
      for (const item of items) {
        let thumb = isInt ? item.i : `https://gabaritkdp.b-cdn.net/${item.p}/vignette.png`;
        let link = isInt ? item.u : `category.html?path=${encodeURIComponent(item.p)}`;

        const card = document.createElement('div');
        card.className = "category-card";
        card.onclick = () => location.href = link;
        card.innerHTML = `
          <img src="${thumb}" onerror="loadFallback(this, '${item.p}')">
          <div class="category-overlay"><div class="category-name">${item.n}</div></div>
        `;
        grid.appendChild(card);
      }
    }

    // FALLBACK : Si vignette.png n'existe pas, on demande au serveur de nous donner la 1√®re image
    async function loadFallback(imgTag, path) {
      try {
        const res = await fetch(`/.netlify/functions/list-bunny?path=${encodeURIComponent(path)}`);
        const files = await res.json();
        const firstImg = files.find(f => !f.isDir && f.url.includes('vignette.png') === false);
        if (firstImg) imgTag.src = firstImg.url;
        else imgTag.src = "https://via.placeholder.com/400x300?text=KDP+Template";
      } catch (e) { imgTag.src = "https://via.placeholder.com/400x300?text=KDP"; }
    }

    function switchLanguage(lang) {
      localStorage.setItem('preferredLanguage', lang);
      document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.lang === lang));
      document.querySelectorAll('[data-fr][data-en]').forEach(el => { el.innerText = el.getAttribute(`data-${lang}`); });
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderSection(data.premium, 'grid-premium');
      renderSection(data.covers, 'grid-covers');
      renderSection(data.interiors, 'grid-interiors', true);
      switchLanguage(localStorage.getItem('preferredLanguage') || 'en');
    });
  </script>
</body>
</html>