<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-fr="Marketplace - GabaritKDP" data-en="Marketplace - GabaritKDP">Marketplace - GabaritKDP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; background-color: #fff;}
    .header-nav{background:#1e293b; padding:10px 0; position:sticky; top:0; z-index:999; box-shadow:0 2px 10px rgba(0,0,0,0.2)}
    .nav-container{max-width:1400px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; padding:0 20px}
    .logo-nav{display:flex; align-items:center; gap:10px; text-decoration:none; color:#fff}
    .logo-nav img{height:32px;}
    .logo-nav span{font-size:1.1rem; font-weight:700; color:#FF9900}
    .nav-links{display:flex; gap:12px; align-items:center}
    .nav-links a{color:#fff; text-decoration:none; font-weight:500; padding:6px 10px; border-radius:8px; font-size:.85rem}
    .nav-links a:hover{color:#FF9900}
    .express-nav-btn{background:#10b981!important; color:#fff!important}
    .language-selector{background:#fff; border-radius:20px; padding:2px; display:flex}
    .lang-btn{padding:3px 8px; border:none; background:transparent; border-radius:15px; cursor:pointer; font-size:.65rem; font-weight:bold; color: #1e293b}
    .lang-btn.active{background:#FF9900; color:#fff}
    
    .premium-sec { background: #1e293b; padding: 60px 0; }
    .category-card{ position:relative; border-radius:16px; overflow:hidden; aspect-ratio:4/3; cursor:pointer; transition:0.3s; background:#334155; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
    .category-card:hover{ transform:translateY(-8px); }
    .category-card img{ width:100%; height:100%; object-fit:cover; }
    .category-overlay{ position:absolute; inset:0; background:linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 70%); display:flex; flex-direction:column; justify-content:flex-end; padding:20px; pointer-events:none }
    .category-name{ font-size:1rem; font-weight:800; color:#fff; text-transform: uppercase; letter-spacing: 0.5px; }
    .category-link{ color:#FF9900; font-weight:600; font-size:.75rem; margin-top: 4px; }

    footer{background:#0f172a; color:#94a3b8; padding:60px 20px 20px}
    .social-box{background:rgba(255,255,255,0.03); border-radius:16px; padding:30px; text-align:center; margin-bottom:40px; border:1px solid rgba(255,255,255,0.05)}
    .social-links{display:flex; justify-content:center; gap:12px; margin-top:15px}
    .social-link{width:45px; height:45px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-size:1.2rem; transition:.3s}
    .youtube{background:#FF0000} .facebook{background:#1877F2} .instagram{background:linear-gradient(45deg,#405DE6,#833AB4,#E1306C,#FD1D1D)}
    .pinterest{background:#BD081C} .tiktok{background:#000; border:1px solid #444} .linkedin{background:#0A66C2}
    
    @media (max-width: 1024px) { .nav-links { display: none; } }
  </style>
</head>
<body>

  <header class="header-nav notranslate">
    <div class="nav-container">
      <a href="./index.html" class="logo-nav"><img src="logo-gabarit-kdp-site-web.png"><span>GabaritKDP</span></a>
      <nav class="nav-links">
        <a href="./index.html" data-en="üè† Home" data-fr="üè† Accueil">üè† Home</a>
        <a href="./dashboard.html" data-en="üìä Dashboard" data-fr="üìä Tableau">üìä Dashboard</a>
        <a href="./generator.html" class="express-nav-btn" data-en="Express Generator" data-fr="G√©n√©rateur Express">Express Generator</a>
        <a href="./generator-magic.html" data-en="Magic Generator" data-fr="G√©n√©rateur Magique">Magic Generator</a>
        <a href="./marketplace.html">Marketplace</a>
        <a href="./inscription.html" data-en="üìù Sign Up" data-fr="üìù Inscription">üìù Sign Up</a>
        <a href="./connexion.html" data-en="üîì Login" data-fr="üîì Connexion">üîì Login</a>
      </nav>
      <div class="language-selector">
        <button class="lang-btn" data-lang="fr" onclick="switchLanguage('fr')">FR</button>
        <button class="lang-btn active" data-lang="en" onclick="switchLanguage('en')">US</button>
      </div>
    </div>
  </header>

  <section class="py-12 bg-slate-50 text-center">
    <h1 class="text-4xl font-black text-gray-900 mb-2">Marketplace <span style="color:#FF9900;">KDP</span></h1>
    <p class="text-lg text-gray-600" data-en="6600+ professional templates" data-fr="6600+ templates professionnels">6600+ professional templates</p>
  </section>

  <!-- PREMIUM SECTION -->
  <section class="premium-sec">
    <div class="max-w-7xl mx-auto px-4">
      <h2 class="text-2xl font-bold text-white mb-10 text-center uppercase tracking-widest">üî• Premium Edition</h2>
      <div id="grid-premium" class="grid grid-cols-2 md:grid-cols-4 gap-6">
          <div class="col-span-full text-center text-gray-400">Loading Premium Categories...</div>
      </div>
    </div>
  </section>

  <!-- BACKGROUND COVERS -->
  <section class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4">
      <h2 class="text-2xl font-bold text-center mb-10 text-gray-900 uppercase tracking-widest">üìö Book Covers</h2>
      <div id="grid-backgrounds" class="grid grid-cols-2 md:grid-cols-4 gap-6">
          <div class="col-span-full text-center">Loading Backgrounds...</div>
      </div>
    </div>
  </section>

  <!-- BOOK INTERIORS (R√©tabli) -->
  <section class="py-20 bg-slate-50">
    <div class="max-w-7xl mx-auto px-4">
      <h2 class="text-2xl font-bold text-center mb-10 text-gray-900 uppercase tracking-widest">üìñ Book Interiors</h2>
      <div id="grid-interiors" class="grid grid-cols-2 md:grid-cols-2 max-w-3xl mx-auto gap-8">
          <div class="col-span-full text-center text-gray-400 italic">Syncing interiors...</div>
      </div>
    </div>
  </section>

  <footer>
    <div class="max-w-6xl mx-auto">
      <div class="social-box">
        <h4 class="text-white font-bold" data-en="üöÄ Follow us for news!" data-fr="üöÄ Suivez-nous pour les actus !">üöÄ Follow us for news!</h4>
        <div class="social-links">
          <a href="https://www.youtube.com/@Gabaritkdp" class="social-link youtube"><i class="fab fa-youtube"></i></a>
          <a href="https://www.facebook.com/profile.php?id=61578785408904" class="social-link facebook"><i class="fab fa-facebook-f"></i></a>
          <a href="https://www.instagram.com/gabaritkdp/" class="social-link instagram"><i class="fab fa-instagram"></i></a>
          <a href="https://fr.pinterest.com/Gabaritkdp/" class="social-link pinterest"><i class="fab fa-pinterest-p"></i></a>
          <a href="https://www.tiktok.com/@gabaritkdp" class="social-link tiktok"><i class="fab fa-tiktok"></i></a>
          <a href="https://www.linkedin.com/in/gabarit-kdp-073368378/" class="social-link linkedin"><i class="fab fa-linkedin-in"></i></a>
        </div>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-sm text-center md:text-left">
        <div><h4 class="text-white font-bold mb-4">GabaritKDP</h4><p>100% Amazon-compliant KDP generator.</p></div>
        <div><h4 class="text-white font-bold mb-4">Product</h4><ul><li>Generator</li><li>Marketplace</li></ul></div>
        <div><h4 class="text-white font-bold mb-4">Support</h4><ul><li>FAQ</li><li>Contact</li></ul></div>
        <div><h4 class="text-white font-bold mb-4">Legal</h4><ul><li>Terms</li><li>Privacy</li></ul></div>
      </div>
    </div>
  </footer>

  <script>
    async function loadAutoCategories(bunnyPath, gridId) {
        const grid = document.getElementById(gridId);
        try {
            const response = await fetch(`/.netlify/functions/list-bunny?path=${encodeURIComponent(bunnyPath)}`);
            const items = await response.json();
            grid.innerHTML = ""; 

            items.forEach(item => {
                if (item.isDir) {
                    const card = document.createElement('div');
                    card.className = "category-card";
                    card.onclick = () => location.href = `category.html?path=${encodeURIComponent(item.path)}`;
                    
                    // URL de la vignette (on force vignette.png)
                    const thumb = item.url;

                    card.innerHTML = `
                        <img src="${thumb}" onerror="this.parentElement.classList.add('no-img'); this.style.display='none';" loading="lazy">
                        <div class="category-overlay">
                            <div class="category-name">${item.name.replace(/-/g, ' ').replace(/_/g, ' ')}</div>
                            <div class="category-link" data-en="Explore ‚Üí" data-fr="Explorer ‚Üí">Explore ‚Üí</div>
                        </div>
                    `;
                    grid.appendChild(card);
                }
            });
        } catch (e) { console.error(e); }
    }

    function switchLanguage(l) {
      localStorage.setItem('preferredLanguage', l);
      document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.dataset.lang === l));
      document.querySelectorAll('[data-en][data-fr]').forEach(el => {
        el.innerText = el.getAttribute(`data-${l}`);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
        // CHARGEMENT AUTOMATIQUE DES 3 SECTIONS
        loadAutoCategories('FULL COVER', 'grid-premium');
        loadAutoCategories('backgrounds', 'grid-backgrounds');
        
        // CORRECTION : On pointe vers le bon dossier pour les int√©rieurs
        // Si tes dossiers s'appellent PLANNERS et COLORIAGES sur Bunny, c'est ici :
        loadAutoCategories('backgrounds/PLANNERS', 'grid-interiors'); 
        loadAutoCategories('backgrounds/COLORIAGES', 'grid-interiors'); 

        switchLanguage(localStorage.getItem('preferredLanguage') || 'en');
    });
  </script>
</body>
</html>