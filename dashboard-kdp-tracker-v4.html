<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-fr="KDP Tracker - GabaritKDP" data-en="KDP Tracker - GabaritKDP">KDP Tracker - GabaritKDP</title>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
  
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <style>
    :root {
      --brand-primary: #FF9900;
      --brand-secondary: #FF6600;
      --brand-dark: #1a1a1a;
      --brand-darker: #0f0f0f;
      --brand-light: #2d2d2d;
      --brand-lighter: #3a3a3a;
      --text-primary: #ffffff;
      --text-secondary: #aaaaaa;
      --border: rgba(255, 153, 0, 0.3);
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, var(--brand-dark) 0%, var(--brand-light) 100%);
      color: var(--text-primary);
      min-height: 100vh;
    }

    /* HEADER */
    .header-nav {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      padding: 15px 0;
      box-shadow: 0 4px 20px rgba(0,0,0,.3);
      position: sticky;
      top: 0;
      z-index: 999;
    }

    .nav-container {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--brand-primary);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .logo-text {
      font-size: 24px;
      font-weight: 700;
      color: var(--brand-primary);
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .nav-links a {
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 6px;
      transition: all 0.3s;
      font-size: 15px;
    }

    .nav-links a:hover {
      background: rgba(255, 153, 0, 0.1);
      color: var(--brand-primary);
    }

    .nav-links a.active {
      background: rgba(255, 153, 0, 0.2);
      color: var(--brand-primary);
    }

    .language-selector {
      display: flex;
      gap: 5px;
      background: rgba(255, 255, 255, 0.1);
      padding: 4px;
      border-radius: 20px;
    }

    .lang-btn {
      padding: 6px 12px;
      border: none;
      background: transparent;
      color: white;
      border-radius: 16px;
      cursor: pointer;
      transition: 0.3s;
      font-size: 14px;
    }

    .lang-btn.active {
      background: var(--brand-primary);
    }

    /* MAIN CONTENT */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    /* SYNC STATUS BANNER */
    .sync-banner {
      background: linear-gradient(135deg, var(--brand-light), var(--brand-lighter));
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 20px;
    }

    .sync-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .sync-icon {
      width: 50px;
      height: 50px;
      background: var(--brand-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .sync-details h3 {
      font-size: 18px;
      margin-bottom: 5px;
    }

    .sync-time {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .sync-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-sync {
      background: var(--brand-primary);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-sync:hover {
      background: var(--brand-secondary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 153, 0, 0.3);
    }

    .btn-sync:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: transparent;
      color: var(--text-primary);
      border: 2px solid var(--border);
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-secondary:hover {
      border-color: var(--brand-primary);
      color: var(--brand-primary);
    }

    /* STATS CARDS */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--brand-light), var(--brand-lighter));
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 25px;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary));
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border-color: var(--brand-primary);
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-icon {
      font-size: 24px;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      color: var(--brand-primary);
      margin-bottom: 8px;
    }

    .stat-change {
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .stat-change.positive {
      color: var(--success);
    }

    .stat-change.negative {
      color: var(--error);
    }

    /* CHARTS SECTION */
    .charts-section {
      margin-bottom: 40px;
    }

    .chart-container {
      background: linear-gradient(135deg, var(--brand-light), var(--brand-lighter));
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .chart-title {
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .chart-filters {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-btn {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-secondary);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .filter-btn:hover {
      border-color: var(--brand-primary);
      color: var(--brand-primary);
    }

    .filter-btn.active {
      background: var(--brand-primary);
      color: white;
      border-color: var(--brand-primary);
    }

    .chart-canvas {
      position: relative;
      height: 350px;
    }

    /* BOOKS TABLE */
    .books-section {
      background: linear-gradient(135deg, var(--brand-light), var(--brand-lighter));
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .section-title {
      font-size: 22px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .search-box {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .search-input {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
      font-size: 14px;
      min-width: 250px;
    }

    .search-input::placeholder {
      color: var(--text-secondary);
    }

    .books-table {
      width: 100%;
      border-collapse: collapse;
      overflow-x: auto;
    }

    .books-table thead th {
      text-align: left;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-secondary);
      font-weight: 600;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid var(--border);
    }

    .books-table tbody tr {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s;
    }

    .books-table tbody tr:hover {
      background: rgba(255, 153, 0, 0.05);
    }

    .books-table tbody td {
      padding: 18px 15px;
      font-size: 14px;
    }

    .book-title {
      font-weight: 600;
      color: var(--text-primary);
      max-width: 300px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .marketplace-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      background: rgba(255, 153, 0, 0.2);
      color: var(--brand-primary);
    }

    .performance-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }

    .performance-indicator.high {
      color: var(--success);
    }

    .performance-indicator.medium {
      color: var(--warning);
    }

    .performance-indicator.low {
      color: var(--error);
    }

    /* EMPTY STATE */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .empty-description {
      color: var(--text-secondary);
      font-size: 16px;
      margin-bottom: 30px;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    /* LOADING */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      gap: 10px;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 153, 0, 0.1);
      border-top-color: var(--brand-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .nav-links {
        display: none;
      }

      .sync-banner {
        flex-direction: column;
        align-items: flex-start;
      }

      .stat-value {
        font-size: 28px;
      }

      .chart-canvas {
        height: 250px;
      }

      .books-table {
        font-size: 12px;
      }

      .books-table thead th,
      .books-table tbody td {
        padding: 10px 8px;
      }

      .search-input {
        width: 100%;
        min-width: auto;
      }
    }

    /* MOBILE MENU */
    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: block;
      }
    }

    /* COACHING SECTION */
    .coaching-section {
      background: linear-gradient(135deg, #1e293b, #334155);
      border: 2px solid var(--brand-primary);
      border-radius: 16px;
      padding: 50px 40px;
      margin: 60px 0 40px;
      position: relative;
      overflow: hidden;
    }

    .coaching-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 153, 0, 0.1) 0%, transparent 70%);
      animation: pulse-glow 8s ease-in-out infinite;
    }

    @keyframes pulse-glow {
      0%, 100% { opacity: 0.5; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.1); }
    }

    .coaching-content {
      position: relative;
      z-index: 1;
    }

    .coaching-main {
      text-align: center;
      margin-bottom: 40px;
    }

    /* MASCOTTE */
    .mascotte-hero {
      margin-bottom: 20px;
      position: relative;
    }

    .mascotte-image {
      width: 180px;
      height: auto;
      filter: drop-shadow(0 8px 25px rgba(255, 153, 0, 0.4));
      animation: float 3s ease-in-out infinite;
      transition: all 0.3s;
      cursor: pointer;
    }

    .mascotte-image:hover {
      transform: scale(1.1);
      filter: drop-shadow(0 12px 35px rgba(255, 153, 0, 0.6));
    }

    .mascotte-image.celebrating {
      animation: celebrate 0.6s ease;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
    }

    @keyframes celebrate {
      0%, 100% { transform: rotate(0deg) scale(1); }
      25% { transform: rotate(-10deg) scale(1.1); }
      75% { transform: rotate(10deg) scale(1.1); }
    }

    .coaching-icon {
      font-size: 64px;
      margin-bottom: 20px;
      animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* AMAZON BEST-SELLERS SECTION */
    .amazon-bestsellers-section {
      background: linear-gradient(135deg, rgba(255, 153, 0, 0.1), rgba(255, 102, 0, 0.05));
      border: 2px solid rgba(255, 153, 0, 0.3);
      border-radius: 12px;
      padding: 35px 30px;
      margin-bottom: 30px;
    }

    .bestsellers-title {
      text-align: center;
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .bestsellers-title i {
      color: var(--brand-primary);
      font-size: 28px;
    }

    .live-badge {
      background: #ef4444;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 1px;
      animation: pulse-live 2s infinite;
    }

    @keyframes pulse-live {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .bestsellers-subtitle {
      text-align: center;
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: 25px;
    }

    .bestsellers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .bestseller-card {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      transition: all 0.3s;
      cursor: pointer;
    }

    .bestseller-card:hover {
      border-color: var(--brand-primary);
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(255, 153, 0, 0.3);
    }

    .bestseller-rank {
      background: var(--brand-primary);
      color: #1a1a2e;
      font-weight: 800;
      font-size: 18px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
    }

    .bestseller-category {
      font-size: 12px;
      color: var(--brand-primary);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      text-align: center;
    }

    .bestseller-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
      text-align: center;
      min-height: 40px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .bestseller-stats {
      display: flex;
      justify-content: space-around;
      gap: 10px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .bestseller-stat {
      text-align: center;
    }

    .bestseller-stat-value {
      font-weight: 700;
      color: var(--success);
      font-size: 14px;
    }

    .bestseller-stat-label {
      font-size: 10px;
      color: var(--text-secondary);
      text-transform: uppercase;
    }

    .bestsellers-cta {
      text-align: center;
      padding: 20px;
      background: rgba(255, 153, 0, 0.1);
      border-radius: 8px;
      margin-top: 20px;
    }

    .bestsellers-cta p {
      margin: 0;
      font-weight: 600;
      color: var(--brand-primary);
    }

    /* HASHTAGS SECTION */
    .hashtags-section {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
    }

    .hashtags-title {
      text-align: center;
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .hashtags-subtitle {
      text-align: center;
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: 25px;
    }

    .hashtags-cloud {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .hashtag {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      padding: 10px 18px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .hashtag:hover {
      border-color: var(--brand-primary);
      background: rgba(255, 153, 0, 0.1);
      transform: translateY(-3px);
    }

    .hashtag.hot {
      border-color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
    }

    .hashtag.trending {
      border-color: var(--brand-primary);
      background: rgba(255, 153, 0, 0.1);
    }

    .hashtag.good {
      border-color: #10b981;
      background: rgba(16, 185, 129, 0.1);
    }

    .hashtag.medium {
      border-color: #f59e0b;
      background: rgba(245, 158, 11, 0.1);
    }

    .trend-badge {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 700;
    }

    .hashtags-tips {
      text-align: center;
      padding: 15px;
      background: rgba(255, 153, 0, 0.1);
      border-radius: 8px;
      margin-top: 20px;
    }

    .hashtags-tips p {
      margin: 0;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .hashtags-tips strong {
      color: var(--brand-primary);
    }

    .loading-spinner {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }

    .loading-spinner .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--brand-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    .coaching-title {
      font-size: 36px;
      font-weight: 800;
      margin-bottom: 15px;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .coaching-subtitle {
      font-size: 18px;
      color: var(--text-secondary);
      max-width: 700px;
      margin: 0 auto 40px;
      line-height: 1.6;
    }

    /* MOTIVATION STATS */
    .motivation-stats {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 30px;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .motivation-stat {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 25px 40px;
      text-align: center;
      transition: all 0.3s;
    }

    .motivation-stat.highlight {
      background: linear-gradient(135deg, rgba(255, 153, 0, 0.2), rgba(255, 102, 0, 0.2));
      border-color: var(--brand-primary);
      transform: scale(1.1);
    }

    .motivation-number {
      font-size: 42px;
      font-weight: 800;
      color: var(--brand-primary);
      margin-bottom: 8px;
    }

    .motivation-label {
      font-size: 14px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
    }

    .motivation-arrow {
      font-size: 32px;
      color: var(--brand-primary);
      font-weight: bold;
    }

    /* PROGRESS TO GOAL */
    .progress-to-goal {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 40px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .goal-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .goal-bar {
      width: 100%;
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .goal-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--brand-primary), var(--success));
      border-radius: 10px;
      transition: width 1s ease;
      position: relative;
      overflow: hidden;
    }

    .goal-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .goal-message {
      text-align: center;
      color: var(--text-secondary);
      font-size: 14px;
    }

    /* CTA BUTTONS */
    .coaching-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .btn-cta-primary,
    .btn-cta-secondary {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 25px 30px;
      border-radius: 12px;
      text-decoration: none;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .btn-cta-primary {
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      color: white;
      box-shadow: 0 8px 25px rgba(255, 153, 0, 0.4);
    }

    .btn-cta-primary:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 35px rgba(255, 153, 0, 0.6);
    }

    .btn-cta-secondary {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.2);
      color: white;
    }

    .btn-cta-secondary:hover {
      border-color: var(--brand-primary);
      background: rgba(255, 153, 0, 0.1);
      transform: translateY(-3px);
    }

    .btn-cta-primary i,
    .btn-cta-secondary i {
      font-size: 32px;
    }

    .btn-cta-content {
      flex: 1;
      text-align: left;
    }

    .btn-cta-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .btn-cta-subtitle {
      font-size: 13px;
      opacity: 0.8;
    }

    /* SUCCESS STORIES */
    .success-stories {
      margin-bottom: 40px;
    }

    .success-title {
      text-align: center;
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .success-title i {
      color: var(--warning);
    }

    .success-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .success-card {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s;
    }

    .success-card:hover {
      border-color: var(--brand-primary);
      transform: translateY(-3px);
    }

    .success-quote {
      font-style: italic;
      color: var(--text-secondary);
      margin-bottom: 15px;
      font-size: 14px;
      line-height: 1.5;
    }

    .success-author {
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .success-result {
      color: var(--success);
      font-weight: 700;
      font-size: 16px;
    }

    /* NICHES SUGGESTIONS */
    .niches-suggestions {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 30px;
    }

    .niches-title {
      text-align: center;
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .niches-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .niche-card-mini {
      background: linear-gradient(135deg, var(--brand-light), var(--brand-lighter));
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s;
      cursor: pointer;
    }

    .niche-card-mini:hover {
      border-color: var(--brand-primary);
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    .niche-emoji {
      font-size: 36px;
      margin-bottom: 10px;
    }

    .niche-name-mini {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 8px;
    }

    .niche-potential {
      color: var(--brand-primary);
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 10px;
    }

    .niche-badge-hot {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
    }

    .niche-badge-good {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
    }

    .niche-badge-medium {
      background: rgba(245, 158, 11, 0.2);
      color: #f59e0b;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
    }

    /* MASCOTTE CELEBRATION */
    .mascotte-celebration {
      position: relative;
      margin-bottom: 20px;
      text-align: center;
    }

    .mascotte-money {
      width: 200px;
      height: auto;
      animation: celebrate 3s ease-in-out infinite;
      filter: drop-shadow(0 10px 25px rgba(255, 153, 0, 0.4));
    }

    @keyframes celebrate {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-10px) rotate(-5deg); }
      50% { transform: translateY(0) rotate(0deg); }
      75% { transform: translateY(-10px) rotate(5deg); }
    }

    .mascotte-bubble {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      color: #1e293b;
      padding: 10px 20px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      white-space: nowrap;
      opacity: 0;
      animation: bubble-appear 3s ease-in-out infinite;
    }

    .mascotte-bubble::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      border: 10px solid transparent;
      border-top-color: white;
    }

    @keyframes bubble-appear {
      0%, 20%, 80%, 100% { opacity: 0; transform: translateX(-50%) translateY(10px); }
      30%, 70% { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    /* BEST-SELLERS SECTION */
    .bestsellers-section {
      background: linear-gradient(135deg, rgba(255, 153, 0, 0.1), rgba(255, 102, 0, 0.05));
      border: 2px solid var(--brand-primary);
      border-radius: 16px;
      padding: 40px;
      margin: 40px 0;
    }

    .bestsellers-title {
      text-align: center;
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 10px;
      color: var(--brand-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .bestsellers-subtitle {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 30px;
      font-size: 16px;
    }

    .category-tabs {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .category-tab {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .category-tab:hover {
      border-color: var(--brand-primary);
      background: rgba(255, 153, 0, 0.1);
    }

    .category-tab.active {
      background: var(--brand-primary);
      border-color: var(--brand-primary);
    }

    .bestsellers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .bestseller-card {
      background: linear-gradient(135deg, var(--brand-light), var(--brand-lighter));
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      position: relative;
      transition: all 0.3s;
    }

    .bestseller-card:hover {
      transform: translateY(-5px);
      border-color: var(--brand-primary);
      box-shadow: 0 10px 30px rgba(255, 153, 0, 0.3);
    }

    .bestseller-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 12px;
    }

    .bestseller-image {
      width: 100%;
      height: 200px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .placeholder-image {
      font-size: 64px;
    }

    .bestseller-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 12px;
      min-height: 40px;
    }

    .bestseller-stats {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 12px;
    }

    .stat-item {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .stat-item.green {
      color: var(--success);
      font-weight: 700;
    }

    .stat-item.orange {
      color: var(--warning);
      font-weight: 700;
    }

    .revenue-estimate {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      padding: 8px;
      border-radius: 6px;
      text-align: center;
      font-weight: 700;
      font-size: 14px;
    }

    .api-note {
      text-align: center;
      color: var(--text-secondary);
      font-size: 13px;
      font-style: italic;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }

    /* HASHTAGS SECTION */
    .hashtags-section {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 30px;
      margin: 40px 0;
    }

    .hashtags-title {
      text-align: center;
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .hashtags-subtitle {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 25px;
      font-size: 15px;
    }

    .hashtags-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .hashtag {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 10px 18px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s;
      cursor: pointer;
    }

    .hashtag:hover {
      background: rgba(255, 153, 0, 0.1);
      border-color: var(--brand-primary);
      color: var(--brand-primary);
      transform: translateY(-2px);
    }

    .hashtag.hot {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(245, 158, 11, 0.2));
      border-color: #ef4444;
      animation: pulse-hashtag 2s ease-in-out infinite;
    }

    @keyframes pulse-hashtag {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .hashtags-tip {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 10px;
      padding: 15px 20px;
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .hashtags-tip i {
      color: var(--success);
      font-size: 20px;
    }

    .hashtags-tip span {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.5;
    }

    /* RESPONSIVE COACHING */
    @media (max-width: 768px) {
      .coaching-section {
        padding: 30px 20px;
      }

      .coaching-title {
        font-size: 28px;
      }

      .coaching-subtitle {
        font-size: 16px;
      }

      .motivation-stats {
        flex-direction: column;
        gap: 15px;
      }

      .motivation-arrow {
        transform: rotate(90deg);
      }

      .coaching-actions {
        grid-template-columns: 1fr;
      }

      .success-cards {
        grid-template-columns: 1fr;
      }

      .niches-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }

      .mascotte-money {
        width: 150px;
      }

      .bestsellers-section {
        padding: 25px 20px;
      }

      .bestsellers-title {
        font-size: 22px;
      }

      .category-tabs {
        flex-direction: column;
      }

      .category-tab {
        width: 100%;
      }

      .bestsellers-grid {
        grid-template-columns: 1fr;
      }

      .hashtags-section {
        padding: 20px;
      }

      .hashtags-title {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header-nav">
    <div class="nav-container">
      <a href="index.html" class="logo-section">
        <div class="logo-icon">ðŸ“š</div>
        <span class="logo-text">GabaritKDP</span>
      </a>

      <nav class="nav-links">
        <a href="index.html" data-fr="Accueil" data-en="Home">Accueil</a>
        <a href="dashboard-kdp-tracker.html" class="active" data-fr="KDP Tracker" data-en="KDP Tracker">KDP Tracker</a>
        <a href="generator.html" data-fr="GÃ©nÃ©rateur" data-en="Generator">GÃ©nÃ©rateur</a>
        <a href="marketplace.html" data-fr="Marketplace" data-en="Marketplace">Marketplace</a>
      </nav>

      <div class="language-selector">
        <button class="lang-btn active" data-lang="fr" onclick="switchLanguage('fr')">FR</button>
        <button class="lang-btn" data-lang="en" onclick="switchLanguage('en')">EN</button>
      </div>

      <button class="mobile-menu-btn">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container">
    
    <!-- Sync Status Banner -->
    <div class="sync-banner">
      <div class="sync-info">
        <div class="sync-icon">ðŸ”„</div>
        <div class="sync-details">
          <h3 id="syncStatus" data-fr="Extension GabaritKDP ConnectÃ©e" data-en="GabaritKDP Extension Connected">Extension GabaritKDP ConnectÃ©e</h3>
          <div class="sync-time">
            <span data-fr="DerniÃ¨re synchronisation:" data-en="Last sync:">DerniÃ¨re synchronisation:</span>
            <span id="lastSyncTime">--:--</span>
          </div>
        </div>
      </div>
      <div class="sync-actions">
        <button class="btn-sync" id="refreshBtn" onclick="refreshData()">
          <i class="fas fa-sync-alt"></i>
          <span data-fr="Actualiser" data-en="Refresh">Actualiser</span>
        </button>
        <button class="btn-secondary" onclick="openExtensionGuide()">
          <i class="fas fa-question-circle"></i>
          <span data-fr="Aide" data-en="Help">Aide</span>
        </button>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-header">
          <span class="stat-label" data-fr="Revenus Total" data-en="Total Revenue">Revenus Total</span>
          <span class="stat-icon">ðŸ’°</span>
        </div>
        <div class="stat-value" id="totalRevenue">â‚¬0.00</div>
        <div class="stat-change positive" id="revenueChange">
          <i class="fas fa-arrow-up"></i>
          <span>+0%</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <span class="stat-label" data-fr="Ventes Totales" data-en="Total Sales">Ventes Totales</span>
          <span class="stat-icon">ðŸ“š</span>
        </div>
        <div class="stat-value" id="totalSales">0</div>
        <div class="stat-change positive" id="salesChange">
          <i class="fas fa-arrow-up"></i>
          <span>+0%</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <span class="stat-label" data-fr="Livres Actifs" data-en="Active Books">Livres Actifs</span>
          <span class="stat-icon">ðŸ“–</span>
        </div>
        <div class="stat-value" id="activeBooks">0</div>
        <div class="stat-change">
          <span data-fr="Total publiÃ©" data-en="Total published">Total publiÃ©</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <span class="stat-label" data-fr="Top Performer" data-en="Top Performer">Top Performer</span>
          <span class="stat-icon">ðŸ”¥</span>
        </div>
        <div class="stat-value" id="topBook" style="font-size: 18px; line-height: 1.3;">--</div>
        <div class="stat-change">
          <span id="topBookRevenue">â‚¬0</span>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <!-- Revenue Chart -->
      <div class="chart-container">
        <div class="chart-header">
          <h2 class="chart-title">
            <i class="fas fa-chart-line"></i>
            <span data-fr="Ã‰volution des Revenus" data-en="Revenue Trends">Ã‰volution des Revenus</span>
          </h2>
          <div class="chart-filters">
            <button class="filter-btn" onclick="updateChartPeriod('7d')" data-fr="7 jours" data-en="7 days">7 jours</button>
            <button class="filter-btn active" onclick="updateChartPeriod('30d')" data-fr="30 jours" data-en="30 days">30 jours</button>
            <button class="filter-btn" onclick="updateChartPeriod('90d')" data-fr="90 jours" data-en="90 days">90 jours</button>
            <button class="filter-btn" onclick="updateChartPeriod('1y')" data-fr="1 an" data-en="1 year">1 an</button>
          </div>
        </div>
        <div class="chart-canvas">
          <canvas id="revenueChart"></canvas>
        </div>
      </div>

      <!-- Marketplace Distribution -->
      <div class="chart-container">
        <div class="chart-header">
          <h2 class="chart-title">
            <i class="fas fa-globe"></i>
            <span data-fr="Ventes par Marketplace" data-en="Sales by Marketplace">Ventes par Marketplace</span>
          </h2>
        </div>
        <div class="chart-canvas" style="height: 300px;">
          <canvas id="marketplaceChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Books Table -->
    <div class="books-section" id="booksSection">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-book"></i>
          <span data-fr="Mes Livres" data-en="My Books">Mes Livres</span>
        </h2>
        <div class="search-box">
          <input type="text" class="search-input" id="searchInput" placeholder="Rechercher un livre..." data-fr-placeholder="Rechercher un livre..." data-en-placeholder="Search a book...">
        </div>
      </div>

      <div id="booksTableContainer">
        <!-- Table will be populated by JavaScript -->
        <div class="loading">
          <div class="spinner"></div>
          <span data-fr="Chargement des donnÃ©es..." data-en="Loading data...">Chargement des donnÃ©es...</span>
        </div>
      </div>
    </div>

    <!-- Coaching Section -->
    <div class="coaching-section">
      <div class="coaching-content">
        <div class="coaching-main">
          <!-- Mascotte AnimÃ©e -->
          <div class="mascotte-celebration">
            <img src="mascotte_qui_montre_ses_billets.png" alt="Mascotte GabaritKDP" class="mascotte-money" id="mascotteImg">
            <div class="mascotte-bubble" id="mascotteBubble">
              ðŸ’° Tes ventes explosent !
            </div>
          </div>

          <div class="mascotte-hero">
            <img src="./mascotte_qui_montre_ses_billets.png" alt="GabaritKDP Mascotte" class="mascotte-image" id="mascotteImage">
          </div>
          <h2 class="coaching-title" id="coachingTitle" data-fr="Publie Ton Prochain Livre et BÃ¢tis Ton Empire !" data-en="Publish Your Next Book and Build Your Empire!">
            Publie Ton Prochain Livre et BÃ¢tis Ton Empire !
          </h2>
          <p class="coaching-subtitle" id="coachingMessage">
            <span data-fr="Publie un livre de plus et multiplie tes revenus ! Chaque nouveau livre est une nouvelle source de revenus passifs. BÃ¢tis ton empire du livre, un bestseller Ã  la fois." data-en="Publish one more book and multiply your income! Each new book is a new source of passive income. Build your book empire, one bestseller at a time.">
              Publie un livre de plus et multiplie tes revenus ! Chaque nouveau livre est une nouvelle source de revenus passifs. BÃ¢tis ton empire du livre, un bestseller Ã  la fois.
            </span>
          </p>
          
          <!-- Stats Motivantes -->
          <div class="motivation-stats">
            <div class="motivation-stat">
              <div class="motivation-number" id="potentialBooks">+1</div>
              <div class="motivation-label" data-fr="livre de plus" data-en="more book">livre de plus</div>
            </div>
            <div class="motivation-arrow">â†’</div>
            <div class="motivation-stat highlight">
              <div class="motivation-number" id="potentialRevenue">+â‚¬90</div>
              <div class="motivation-label" data-fr="revenus/mois" data-en="revenue/month">revenus/mois</div>
            </div>
          </div>

          <!-- Progress Bar vers Objectif -->
          <div class="progress-to-goal">
            <div class="goal-header">
              <span data-fr="Ton objectif : 10 livres actifs" data-en="Your goal: 10 active books">Ton objectif : 10 livres actifs</span>
              <span id="goalProgress">0/10</span>
            </div>
            <div class="goal-bar">
              <div class="goal-fill" id="goalFill" style="width: 0%"></div>
            </div>
            <p class="goal-message" id="goalMessage">
              <span data-fr="Tu es Ã  0 livres de ton objectif ! ðŸŽ¯" data-en="You're 0 books away from your goal! ðŸŽ¯">
                Tu es Ã  0 livres de ton objectif ! ðŸŽ¯
              </span>
            </p>
          </div>

          <!-- Call to Actions -->
          <div class="coaching-actions">
            <a href="marketplace.html" class="btn-cta-primary">
              <i class="fas fa-shopping-bag"></i>
              <div class="btn-cta-content">
                <div class="btn-cta-title" data-fr="Explorer la Marketplace" data-en="Explore Marketplace">Explorer la Marketplace</div>
                <div class="btn-cta-subtitle" data-fr="55,000+ couvertures prÃªtes Ã  l'emploi" data-en="55,000+ ready-to-use covers">55,000+ couvertures prÃªtes Ã  l'emploi</div>
              </div>
            </a>
            <a href="generator.html" class="btn-cta-secondary">
              <i class="fas fa-magic"></i>
              <div class="btn-cta-content">
                <div class="btn-cta-title" data-fr="CrÃ©er une Couverture" data-en="Create a Cover">CrÃ©er une Couverture</div>
                <div class="btn-cta-subtitle" data-fr="GÃ©nÃ©rateur 100% conforme Amazon" data-en="100% Amazon-compliant generator">GÃ©nÃ©rateur 100% conforme Amazon</div>
              </div>
            </a>
          </div>
        </div>

        <!-- Success Stories / Social Proof -->
        <div class="success-stories">
          <h3 class="success-title">
            <i class="fas fa-star"></i>
            <span data-fr="Ils l'ont fait, pourquoi pas toi ?" data-en="They did it, why not you?">Ils l'ont fait, pourquoi pas toi ?</span>
          </h3>
          <div class="success-cards">
            <div class="success-card">
              <div class="success-quote">"J'ai publiÃ© 3 livres en 1 mois grÃ¢ce aux templates"</div>
              <div class="success-author">â€” Marie L.</div>
              <div class="success-result">â‚¬450/mois de revenus passifs</div>
            </div>
            <div class="success-card">
              <div class="success-quote">"Le gÃ©nÃ©rateur m'a fait gagner un temps fou"</div>
              <div class="success-author">â€” Thomas B.</div>
              <div class="success-result">12 livres publiÃ©s en 3 mois</div>
            </div>
            <div class="success-card">
              <div class="success-quote">"J'ai doublÃ© mes revenus en 2 mois"</div>
              <div class="success-author">â€” Sophie M.</div>
              <div class="success-result">â‚¬890/mois maintenant</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Amazon Best-Sellers Section -->
      <div class="amazon-bestsellers-section">
        <h3 class="bestsellers-title">
          <i class="fab fa-amazon"></i>
          <span data-fr="ðŸ“š Best-Sellers Amazon KDP du Moment" data-en="ðŸ“š Amazon KDP Best-Sellers Right Now">ðŸ“š Best-Sellers Amazon KDP du Moment</span>
          <span class="live-badge">LIVE</span>
        </h3>
        <div class="bestsellers-subtitle">
          <span data-fr="Les livres qui cartonnent en ce moment sur Amazon" data-en="Books that are crushing it on Amazon right now">Les livres qui cartonnent en ce moment sur Amazon</span>
        </div>
        
        <div class="bestsellers-grid" id="amazonBestsellers">
          <div class="loading-spinner">
            <div class="spinner"></div>
            <span>Chargement des best-sellers...</span>
          </div>
        </div>

        <div class="bestsellers-cta">
          <p data-fr="ðŸ’¡ Inspire-toi de ces succÃ¨s pour ton prochain livre !" data-en="ðŸ’¡ Get inspired by these successes for your next book!">
            ðŸ’¡ Inspire-toi de ces succÃ¨s pour ton prochain livre !
          </p>
        </div>
      </div>

      <!-- Trending Hashtags Section -->
      <div class="hashtags-section">
        <h3 class="hashtags-title">
          <i class="fas fa-hashtag"></i>
          <span data-fr="ðŸ”¥ Hashtags & Mots-ClÃ©s Tendance" data-en="ðŸ”¥ Trending Hashtags & Keywords">ðŸ”¥ Hashtags & Mots-ClÃ©s Tendance</span>
        </h3>
        <div class="hashtags-subtitle">
          <span data-fr="Les termes les plus recherchÃ©s cette semaine" data-en="Most searched terms this week">Les termes les plus recherchÃ©s cette semaine</span>
        </div>
        
        <div class="hashtags-cloud" id="trendingHashtags">
          <!-- Hashtags will be populated by JavaScript -->
          <span class="hashtag hot">#Planner2025 <span class="trend-badge">â†— +340%</span></span>
          <span class="hashtag trending">#Journal <span class="trend-badge">â†— +180%</span></span>
          <span class="hashtag good">#ColoringBook <span class="trend-badge">â†— +120%</span></span>
          <span class="hashtag good">#SelfCare <span class="trend-badge">â†— +95%</span></span>
          <span class="hashtag medium">#Productivity <span class="trend-badge">â†— +75%</span></span>
          <span class="hashtag medium">#Mindfulness <span class="trend-badge">â†— +60%</span></span>
          <span class="hashtag">#ActivityBook <span class="trend-badge">â†— +45%</span></span>
          <span class="hashtag">#SudokuBook <span class="trend-badge">â†— +30%</span></span>
        </div>

        <div class="hashtags-tips">
          <p data-fr="ðŸ’¡ <strong>Astuce Pro :</strong> Utilise 3-5 de ces hashtags dans ton titre et ta description pour maximiser ta visibilitÃ© !" data-en="ðŸ’¡ <strong>Pro Tip:</strong> Use 3-5 of these hashtags in your title and description to maximize visibility!">
            ðŸ’¡ <strong>Astuce Pro :</strong> Utilise 3-5 de ces hashtags dans ton titre et ta description pour maximiser ta visibilitÃ© !
          </p>
        </div>
      </div>

          <!-- ============================================ -->
    <!-- NOUVELLE SECTION NICHES RENTABLES V4 -->
    <!-- ============================================ -->
    
    <!-- Disclaimer Beta Phase 1 -->
    <div class="disclaimer-beta" style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); color: #1a1a1a; padding: 25px 30px; border-radius: 15px; margin: 30px auto; max-width: 1200px; border-left: 5px solid #f57c00; box-shadow: 0 6px 20px rgba(255,193,7,0.3);">
      <div style="font-size: 20px; font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-info-circle"></i>
        <span data-fr="RECHERCHE DE NICHES - Phase 1 : DonnÃ©es EstimÃ©es" data-en="NICHE RESEARCH - Phase 1: Estimated Data">RECHERCHE DE NICHES - Phase 1 : DonnÃ©es EstimÃ©es</span>
      </div>
      <div style="line-height: 1.8; font-size: 15px;">
        <p style="margin-bottom: 12px;"><strong>Les niches et scores affichÃ©s sont basÃ©s sur des analyses de marchÃ© et tendances Amazon 2025.</strong></p>
        <p style="margin-bottom: 12px;">âœ… <strong>Utilise-les pour EXPLORER</strong> des idÃ©es de niches rentables</p>
        <p style="margin-bottom: 12px;">âš ï¸ <strong>VÃ©rifie toujours sur Amazon.com</strong> avant de publier ton livre</p>
        <p>ðŸš€ <strong>Vraies donnÃ©es Amazon arrivent en Phase 2 & 3</strong> (Publisher Rocket + PA-API)</p>
        
        <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid rgba(0,0,0,0.1); display: flex; gap: 15px; flex-wrap: wrap;">
          <div style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 15px; background: rgba(0,0,0,0.15); border-radius: 20px; font-size: 13px; font-weight: 600;">
            <span>ðŸ“ Phase 1</span>
            <span>DonnÃ©es estimÃ©es (ACTUEL)</span>
          </div>
          <div style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 15px; background: rgba(0,0,0,0.15); border-radius: 20px; font-size: 13px; font-weight: 600;">
            <span>ðŸ“Š Phase 2</span>
            <span>70% donnÃ©es rÃ©elles</span>
          </div>
          <div style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 15px; background: rgba(0,0,0,0.15); border-radius: 20px; font-size: 13px; font-weight: 600;">
            <span>âœ… Phase 3</span>
            <span>100% API Amazon</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Section Niches Rentables ComplÃ¨te -->
    <div class="niches-advanced-section" style="background: var(--brand-light); padding: 40px 30px; border-radius: 20px; margin: 30px auto; max-width: 1400px; border: 1px solid var(--border);">
      
      <!-- Header avec message motivant -->
      <div style="text-align: center; margin-bottom: 40px;">
        <h2 style="font-size: 36px; font-weight: 800; background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 15px;">
          ðŸ”Ž <span data-fr="Trouve Ta Prochaine Niche Rentable" data-en="Find Your Next Profitable Niche">Trouve Ta Prochaine Niche Rentable</span>
        </h2>
        <p style="font-size: 18px; color: var(--text-secondary); max-width: 800px; margin: 0 auto 25px; line-height: 1.6;">
          <span data-fr="Chaque ligne est une opportunitÃ©. RepÃ¨re celles qui te donnent envie de crÃ©er et passe Ã  l'action aujourd'hui." data-en="Each row is an opportunity. Spot the ones that inspire you to create and take action today.">
            Chaque ligne est une opportunitÃ©. RepÃ¨re celles qui te donnent envie de crÃ©er et passe Ã  l'action aujourd'hui.
          </span>
        </p>
      </div>

      <!-- Filtres -->
      <div style="background: var(--brand-lighter); padding: 25px; border-radius: 12px; margin-bottom: 25px;">
        <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 20px; color: var(--brand-primary); display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-filter"></i>
          <span data-fr="Filtres d'OpportunitÃ©s" data-en="Opportunity Filters">Filtres d'OpportunitÃ©s</span>
        </h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
          <div style="display: flex; flex-direction: column; gap: 8px;">
            <label style="font-size: 14px; font-weight: 600; color: var(--text-secondary);" data-fr="MarchÃ©" data-en="Market">MarchÃ©</label>
            <select id="filterMarketAdvanced" onchange="applyNichesFilters()" style="padding: 12px 15px; background: var(--brand-light); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 15px; cursor: pointer;">
              <option value="" data-fr="Tous les marchÃ©s" data-en="All markets">Tous les marchÃ©s</option>
              <option value="USA">ðŸ‡ºðŸ‡¸ USA</option>
              <option value="France">ðŸ‡«ðŸ‡· France</option>
            </select>
          </div>

          <div style="display: flex; flex-direction: column; gap: 8px;">
            <label style="font-size: 14px; font-weight: 600; color: var(--text-secondary);" data-fr="Type de Livre" data-en="Book Type">Type de Livre</label>
            <select id="filterTypeAdvanced" onchange="applyNichesFilters()" style="padding: 12px 15px; background: var(--brand-light); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 15px; cursor: pointer;">
              <option value="" data-fr="Tous les types" data-en="All types">Tous les types</option>
              <option value="Coloring book">ðŸŽ¨ Coloring Book</option>
              <option value="Journal">ðŸ“” Journal</option>
              <option value="Planner">ðŸ“… Planner</option>
              <option value="Activity book">ðŸŽ¯ Activity Book</option>
              <option value="Notebook">ðŸ““ Notebook</option>
              <option value="Roman">ðŸ“š Roman</option>
              <option value="Non-fiction">ðŸ“– Non-Fiction</option>
            </select>
          </div>

          <div style="display: flex; flex-direction: column; gap: 8px;">
            <label style="font-size: 14px; font-weight: 600; color: var(--text-secondary);" data-fr="Score Minimum" data-en="Minimum Score">Score Minimum</label>
            <select id="filterScoreAdvanced" onchange="applyNichesFilters()" style="padding: 12px 15px; background: var(--brand-light); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 15px; cursor: pointer;">
              <option value="0" data-fr="Tous les scores" data-en="All scores">Tous les scores</option>
              <option value="70">â­ OpportunitÃ©s vertes (70+)</option>
              <option value="40">ðŸ’¡ Ã€ creuser (40+)</option>
            </select>
          </div>
        </div>

        <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--brand-light); border-radius: 8px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,153,0,0.1)'" onmouseout="this.style.background='var(--brand-light)'">
          <input type="checkbox" id="filterLowCompAdvanced" onchange="applyNichesFilters()" style="width: 20px; height: 20px; cursor: pointer; accent-color: var(--brand-primary);">
          <label for="filterLowCompAdvanced" style="cursor: pointer; font-size: 15px; flex: 1;">
            <span data-fr="ðŸŒ± Afficher uniquement les niches Ã  faible concurrence" data-en="ðŸŒ± Show only low competition niches">ðŸŒ± Afficher uniquement les niches Ã  faible concurrence</span>
          </label>
        </div>

        <div id="filterStatsAdvanced" style="background: rgba(255,153,0,0.1); padding: 15px 20px; border-radius: 10px; margin-top: 15px; font-size: 15px; text-align: center; color: var(--brand-primary); font-weight: 600;">
          <span data-fr="Toutes les niches affichÃ©es" data-en="All niches displayed">Toutes les niches affichÃ©es</span>
        </div>
      </div>

      <!-- Message motivant dynamique -->
      <div id="motivationalMsgAdvanced" style="background: rgba(255,153,0,0.1); padding: 15px 20px; border-radius: 10px; border-left: 4px solid var(--brand-primary); margin-bottom: 20px; font-size: 15px; line-height: 1.6;">
        ðŸ’¡ <strong>Chaque ligne est une opportunitÃ©.</strong> <span data-fr="Ta mission : repÃ©rer celles qui te donnent envie de crÃ©erâ€¦ et ne plus les laisser dormir dans un tableau." data-en="Your mission: spot the ones that make you want to create... and stop letting them sleep in a spreadsheet.">Ta mission : repÃ©rer celles qui te donnent envie de crÃ©erâ€¦ et ne plus les laisser dormir dans un tableau.</span>
      </div>

      <!-- Tableau Niches -->
      <div style="overflow-x: auto; border-radius: 12px; border: 1px solid var(--border);">
        <table id="nichesTableAdvanced" style="width: 100%; border-collapse: collapse; background: var(--brand-lighter);">
          <thead style="background: var(--brand-dark);">
            <tr>
              <th style="padding: 16px 20px; text-align: left; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--brand-primary); border-bottom: 2px solid var(--brand-primary);" data-fr="Niche" data-en="Niche">Niche</th>
              <th style="padding: 16px 20px; text-align: left; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--brand-primary); border-bottom: 2px solid var(--brand-primary);" data-fr="MarchÃ©" data-en="Market">MarchÃ©</th>
              <th style="padding: 16px 20px; text-align: left; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--brand-primary); border-bottom: 2px solid var(--brand-primary);" data-fr="Type" data-en="Type">Type</th>
              <th style="padding: 16px 20px; text-align: left; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--brand-primary); border-bottom: 2px solid var(--brand-primary);" data-fr="Demande" data-en="Demand">Demande</th>
              <th style="padding: 16px 20px; text-align: left; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--brand-primary); border-bottom: 2px solid var(--brand-primary);" data-fr="Concurrence" data-en="Competition">Concurrence</th>
              <th style="padding: 16px 20px; text-align: left; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--brand-primary); border-bottom: 2px solid var(--brand-primary);" data-fr="BSR Moyen" data-en="Avg BSR">BSR Moyen</th>
              <th style="padding: 16px 20px; text-align: center; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--brand-primary); border-bottom: 2px solid var(--brand-primary);" data-fr="Score" data-en="Score">Score</th>
              <th style="padding: 16px 20px; text-align: left; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--brand-primary); border-bottom: 2px solid var(--brand-primary);" data-fr="Badges" data-en="Badges">Badges</th>
            </tr>
          </thead>
          <tbody id="nichesBodyAdvanced">
            <!-- Sera rempli par JavaScript -->
          </tbody>
        </table>
      </div>
    </div>


    </div>

    <!-- Best-Sellers Amazon KDP Section -->
    <div class="bestsellers-section">
      <h3 class="bestsellers-title">
        <i class="fas fa-trophy"></i>
        <span data-fr="ðŸ“š Best-Sellers Amazon KDP du Moment" data-en="ðŸ“š Amazon KDP Best-Sellers Right Now">ðŸ“š Best-Sellers Amazon KDP du Moment</span>
      </h3>
      
      <p class="bestsellers-subtitle" data-fr="Inspire-toi des livres qui cartonnent en ce moment sur Amazon !" data-en="Get inspired by the books crushing it on Amazon right now!">
        Inspire-toi des livres qui cartonnent en ce moment sur Amazon !
      </p>

      <!-- Category Tabs -->
      <div class="category-tabs">
        <button class="category-tab active" onclick="loadBestSellers('planners')" data-fr="ðŸ“” Planners" data-en="ðŸ“” Planners">ðŸ“” Planners</button>
        <button class="category-tab" onclick="loadBestSellers('journals')" data-fr="ðŸ““ Journals" data-en="ðŸ““ Journals">ðŸ““ Journals</button>
        <button class="category-tab" onclick="loadBestSellers('coloring')" data-fr="ðŸŽ¨ Coloriages" data-en="ðŸŽ¨ Coloring">ðŸŽ¨ Coloriages</button>
        <button class="category-tab" onclick="loadBestSellers('notebooks')" data-fr="ðŸ“’ Notebooks" data-en="ðŸ“’ Notebooks">ðŸ“’ Notebooks</button>
      </div>

      <!-- Best-Sellers Grid -->
      <div class="bestsellers-grid" id="bestsellersGrid">
        <!-- Demo data - Will be populated by API -->
        <div class="bestseller-card">
          <div class="bestseller-badge">ðŸ† #1</div>
          <div class="bestseller-image">
            <div class="placeholder-image">ðŸ“”</div>
          </div>
          <h4 class="bestseller-title">2025 Daily Planner</h4>
          <div class="bestseller-stats">
            <span class="stat-item"><strong>BSR:</strong> ~12,450</span>
            <span class="stat-item"><strong>Prix:</strong> $10.99</span>
            <span class="stat-item green"><strong>~120</strong> ventes/mois</span>
          </div>
          <div class="revenue-estimate">â‰ˆ â‚¬290/mois potentiel</div>
        </div>

        <div class="bestseller-card">
          <div class="bestseller-badge">ðŸ¥ˆ #2</div>
          <div class="bestseller-image">
            <div class="placeholder-image">ðŸ““</div>
          </div>
          <h4 class="bestseller-title">Gratitude Journal Daily</h4>
          <div class="bestseller-stats">
            <span class="stat-item"><strong>BSR:</strong> ~18,200</span>
            <span class="stat-item"><strong>Prix:</strong> $9.99</span>
            <span class="stat-item green"><strong>~90</strong> ventes/mois</span>
          </div>
          <div class="revenue-estimate">â‰ˆ â‚¬210/mois potentiel</div>
        </div>

        <div class="bestseller-card">
          <div class="bestseller-badge">ðŸ¥‰ #3</div>
          <div class="bestseller-image">
            <div class="placeholder-image">ðŸ“”</div>
          </div>
          <h4 class="bestseller-title">Weekly Planner Undated</h4>
          <div class="bestseller-stats">
            <span class="stat-item"><strong>BSR:</strong> ~25,600</span>
            <span class="stat-item"><strong>Prix:</strong> $11.99</span>
            <span class="stat-item green"><strong>~75</strong> ventes/mois</span>
          </div>
          <div class="revenue-estimate">â‰ˆ â‚¬210/mois potentiel</div>
        </div>

        <div class="bestseller-card">
          <div class="bestseller-badge">#4</div>
          <div class="bestseller-image">
            <div class="placeholder-image">ðŸ““</div>
          </div>
          <h4 class="bestseller-title">Goal Setting Planner</h4>
          <div class="bestseller-stats">
            <span class="stat-item"><strong>BSR:</strong> ~32,400</span>
            <span class="stat-item"><strong>Prix:</strong> $10.99</span>
            <span class="stat-item orange"><strong>~60</strong> ventes/mois</span>
          </div>
          <div class="revenue-estimate">â‰ˆ â‚¬155/mois potentiel</div>
        </div>
      </div>

      <div class="api-note">
        ðŸ’¡ <span data-fr="DonnÃ©es mises Ã  jour en temps rÃ©el via Amazon Product Advertising API" data-en="Data updated in real-time via Amazon Product Advertising API">DonnÃ©es mises Ã  jour en temps rÃ©el via Amazon Product Advertising API</span>
      </div>
    </div>

    <!-- Hashtags Tendance Section -->
    <div class="hashtags-section">
      <h3 class="hashtags-title">
        <i class="fas fa-hashtag"></i>
        <span data-fr="ðŸ·ï¸ Hashtags & Keywords Tendance" data-en="ðŸ·ï¸ Trending Hashtags & Keywords">ðŸ·ï¸ Hashtags & Keywords Tendance</span>
      </h3>
      
      <p class="hashtags-subtitle" data-fr="Utilise ces mots-clÃ©s dans tes descriptions pour booster ta visibilitÃ© !" data-en="Use these keywords in your descriptions to boost visibility!">
        Utilise ces mots-clÃ©s dans tes descriptions pour booster ta visibilitÃ© !
      </p>

      <div class="hashtags-grid">
        <span class="hashtag hot">#KDP</span>
        <span class="hashtag hot">#SelfPublishing</span>
        <span class="hashtag hot">#Planners2025</span>
        <span class="hashtag">#LowContentBooks</span>
        <span class="hashtag">#PassiveIncome</span>
        <span class="hashtag">#JournalPrompts</span>
        <span class="hashtag">#ColoringBooks</span>
        <span class="hashtag">#Productivity</span>
        <span class="hashtag">#Goals</span>
        <span class="hashtag">#Mindfulness</span>
        <span class="hashtag">#Wellness</span>
        <span class="hashtag">#BulletJournal</span>
        <span class="hashtag">#Gratitude</span>
        <span class="hashtag">#DailyPlanner</span>
        <span class="hashtag">#ActivityBooks</span>
        <span class="hashtag">#Notebooks</span>
        <span class="hashtag">#CreativeJournaling</span>
        <span class="hashtag">#AmazonKDP</span>
        <span class="hashtag">#BookPublishing</span>
        <span class="hashtag">#PrintOnDemand</span>
      </div>

      <div class="hashtags-tip">
        <i class="fas fa-lightbulb"></i>
        <span data-fr="Astuce : Utilise 5-7 hashtags pertinents dans la description de chaque livre pour maximiser ta visibilitÃ© !" data-en="Tip: Use 5-7 relevant hashtags in each book description to maximize visibility!">
          Astuce : Utilise 5-7 hashtags pertinents dans la description de chaque livre pour maximiser ta visibilitÃ© !
        </span>
      </div>
    </div>

  </div>

  <script>
    // Supabase Configuration - REMPLACE PAR TES VRAIES CLÃ‰S
    const SUPABASE_URL = 'https://bgcspojhiucprzlkwax.supabase.co'; // Remplace par ton URL
    const SUPABASE_KEY = 'TON_ANON_KEY_ICI'; // Remplace par ta clÃ©
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Global variables
    let revenueChart = null;
    let marketplaceChart = null;
    let currentPeriod = '30d';
    let allBooks = [];

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      initializeCharts();
      loadData();
      setupSearchFilter();
      checkExtensionStatus();
      updateLastSyncTime();
      updateCoachingSection();
    });

    // Load all data
    async function loadData() {
      try {
        await Promise.all([
          loadSummaryStats(),
          loadRevenueChart(),
          loadMarketplaceChart(),
          loadBooksTable()
        ]);
        // Update coaching aprÃ¨s chargement des donnÃ©es
        updateCoachingSection();
      } catch (error) {
        console.error('Error loading data:', error);
        showError('Erreur de chargement des donnÃ©es');
      }
    }

    // Load summary statistics
    async function loadSummaryStats() {
      try {
        // Get latest summary
        const { data: summary, error } = await supabase
          .from('kdp_summary')
          .select('*')
          .order('created_at', { ascending: false })
          .limit(1)
          .single();

        if (error) throw error;

        if (summary) {
          document.getElementById('totalRevenue').textContent = `â‚¬${summary.total_revenue?.toFixed(2) || '0.00'}`;
          document.getElementById('totalSales').textContent = summary.total_sales || '0';
          document.getElementById('activeBooks').textContent = summary.active_books || '0';
          
          // Calculate changes (mock for now)
          updateChangeIndicator('revenueChange', 12.5, true);
          updateChangeIndicator('salesChange', 8.3, true);
        }

        // Get top performing book
        const { data: topBook, error: bookError } = await supabase
          .from('kdp_books')
          .select('*')
          .order('total_revenue', { ascending: false })
          .limit(1)
          .single();

        if (topBook) {
          document.getElementById('topBook').textContent = topBook.title || '--';
          document.getElementById('topBookRevenue').textContent = `â‚¬${topBook.total_revenue?.toFixed(2) || '0'}`;
        }

      } catch (error) {
        console.error('Error loading summary:', error);
      }
    }

    // Load revenue chart
    async function loadRevenueChart() {
      try {
        // Calculate date range based on period
        const endDate = new Date();
        const startDate = new Date();
        
        switch(currentPeriod) {
          case '7d':
            startDate.setDate(endDate.getDate() - 7);
            break;
          case '30d':
            startDate.setDate(endDate.getDate() - 30);
            break;
          case '90d':
            startDate.setDate(endDate.getDate() - 90);
            break;
          case '1y':
            startDate.setFullYear(endDate.getFullYear() - 1);
            break;
        }

        const { data: sales, error } = await supabase
          .from('kdp_sales')
          .select('*')
          .gte('sale_date', startDate.toISOString())
          .lte('sale_date', endDate.toISOString())
          .order('sale_date', { ascending: true });

        if (error) throw error;

        // Aggregate by date
        const dailyRevenue = {};
        sales?.forEach(sale => {
          const date = new Date(sale.sale_date).toLocaleDateString();
          dailyRevenue[date] = (dailyRevenue[date] || 0) + (sale.royalty || 0);
        });

        const labels = Object.keys(dailyRevenue);
        const data = Object.values(dailyRevenue);

        updateRevenueChart(labels, data);

      } catch (error) {
        console.error('Error loading revenue chart:', error);
      }
    }

    // Load marketplace chart
    async function loadMarketplaceChart() {
      try {
        const { data: sales, error } = await supabase
          .from('kdp_sales')
          .select('marketplace, royalty');

        if (error) throw error;

        // Aggregate by marketplace
        const marketplaceData = {};
        sales?.forEach(sale => {
          const market = sale.marketplace || 'Unknown';
          marketplaceData[market] = (marketplaceData[market] || 0) + (sale.royalty || 0);
        });

        const labels = Object.keys(marketplaceData);
        const data = Object.values(marketplaceData);

        updateMarketplaceChart(labels, data);

      } catch (error) {
        console.error('Error loading marketplace chart:', error);
      }
    }

    // Load books table
    async function loadBooksTable() {
      try {
        const { data: books, error } = await supabase
          .from('kdp_books')
          .select('*')
          .order('total_revenue', { ascending: false });

        if (error) throw error;

        allBooks = books || [];
        renderBooksTable(allBooks);

      } catch (error) {
        console.error('Error loading books:', error);
        showEmptyState();
      }
    }

    // Render books table
    function renderBooksTable(books) {
      const container = document.getElementById('booksTableContainer');
      
      if (!books || books.length === 0) {
        showEmptyState();
        return;
      }

      const tableHTML = `
        <table class="books-table">
          <thead>
            <tr>
              <th data-fr="Titre" data-en="Title">Titre</th>
              <th>ASIN</th>
              <th data-fr="Marketplace" data-en="Marketplace">Marketplace</th>
              <th data-fr="Ventes" data-en="Sales">Ventes</th>
              <th data-fr="Revenus" data-en="Revenue">Revenus</th>
              <th>BSR</th>
              <th data-fr="Performance" data-en="Performance">Performance</th>
            </tr>
          </thead>
          <tbody>
            ${books.map(book => `
              <tr>
                <td><div class="book-title">${book.title || '--'}</div></td>
                <td>${book.asin || '--'}</td>
                <td><span class="marketplace-badge">${book.marketplace || '--'}</span></td>
                <td>${book.total_sales || 0}</td>
                <td>â‚¬${book.total_revenue?.toFixed(2) || '0.00'}</td>
                <td>${book.bsr ? book.bsr.toLocaleString() : '--'}</td>
                <td>${getPerformanceIndicator(book.total_revenue)}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;

      container.innerHTML = tableHTML;
    }

    // Show empty state
    function showEmptyState() {
      const container = document.getElementById('booksTableContainer');
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">ðŸ“š</div>
          <h3 class="empty-title" data-fr="Aucune donnÃ©e disponible" data-en="No data available">Aucune donnÃ©e disponible</h3>
          <p class="empty-description" data-fr="Utilisez l'extension Chrome GabaritKDP pour synchroniser vos donnÃ©es Amazon KDP" data-en="Use the GabaritKDP Chrome extension to sync your Amazon KDP data">
            Utilisez l'extension Chrome GabaritKDP pour synchroniser vos donnÃ©es Amazon KDP
          </p>
          <button class="btn-sync" onclick="openExtensionGuide()">
            <i class="fas fa-download"></i>
            <span data-fr="TÃ©lÃ©charger l'extension" data-en="Download extension">TÃ©lÃ©charger l'extension</span>
          </button>
        </div>
      `;
    }

    // Initialize charts
    function initializeCharts() {
      // Revenue Chart
      const revenueCtx = document.getElementById('revenueChart').getContext('2d');
      revenueChart = new Chart(revenueCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Revenus (â‚¬)',
            data: [],
            borderColor: '#FF9900',
            backgroundColor: 'rgba(255, 153, 0, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: '#ffffff' }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { color: '#aaaaaa' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            x: {
              ticks: { color: '#aaaaaa' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            }
          }
        }
      });

      // Marketplace Chart
      const marketplaceCtx = document.getElementById('marketplaceChart').getContext('2d');
      marketplaceChart = new Chart(marketplaceCtx, {
        type: 'doughnut',
        data: {
          labels: [],
          datasets: [{
            data: [],
            backgroundColor: [
              '#FF9900',
              '#FF6600',
              '#10b981',
              '#f59e0b',
              '#ef4444'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: { color: '#ffffff' }
            }
          }
        }
      });
    }

    // Update revenue chart
    function updateRevenueChart(labels, data) {
      if (revenueChart) {
        revenueChart.data.labels = labels;
        revenueChart.data.datasets[0].data = data;
        revenueChart.update();
      }
    }

    // Update marketplace chart
    function updateMarketplaceChart(labels, data) {
      if (marketplaceChart) {
        marketplaceChart.data.labels = labels;
        marketplaceChart.data.datasets[0].data = data;
        marketplaceChart.update();
      }
    }

    // Update chart period
    function updateChartPeriod(period) {
      currentPeriod = period;
      
      // Update active button
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      loadRevenueChart();
    }

    // Setup search filter
    function setupSearchFilter() {
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const filtered = allBooks.filter(book => 
          book.title?.toLowerCase().includes(searchTerm) ||
          book.asin?.toLowerCase().includes(searchTerm)
        );
        renderBooksTable(filtered);
      });
    }

    // Get performance indicator
    function getPerformanceIndicator(revenue) {
      if (!revenue) return '<span class="performance-indicator low"><i class="fas fa-arrow-down"></i> Faible</span>';
      if (revenue > 100) return '<span class="performance-indicator high"><i class="fas fa-arrow-up"></i> Excellent</span>';
      if (revenue > 50) return '<span class="performance-indicator medium"><i class="fas fa-arrow-right"></i> Moyen</span>';
      return '<span class="performance-indicator low"><i class="fas fa-arrow-down"></i> Faible</span>';
    }

    // Update change indicator
    function updateChangeIndicator(elementId, value, isPositive) {
      const element = document.getElementById(elementId);
      element.className = `stat-change ${isPositive ? 'positive' : 'negative'}`;
      element.innerHTML = `
        <i class="fas fa-arrow-${isPositive ? 'up' : 'down'}"></i>
        <span>${isPositive ? '+' : ''}${value}%</span>
      `;
    }

    // Refresh data
    async function refreshData() {
      const btn = document.getElementById('refreshBtn');
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span data-fr="Actualisation..." data-en="Refreshing...">Actualisation...</span>';
      
      await loadData();
      updateLastSyncTime();
      
      setTimeout(() => {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-sync-alt"></i> <span data-fr="Actualiser" data-en="Refresh">Actualiser</span>';
      }, 1000);
    }

    // Check extension status
    function checkExtensionStatus() {
      // This would check if Chrome extension is installed
      // For now, just show connected
      const statusEl = document.getElementById('syncStatus');
      statusEl.innerHTML = '<span data-fr="Extension GabaritKDP ConnectÃ©e" data-en="GabaritKDP Extension Connected">Extension GabaritKDP ConnectÃ©e</span> <i class="fas fa-check-circle" style="color: #10b981;"></i>';
    }

    // Update last sync time
    function updateLastSyncTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
      document.getElementById('lastSyncTime').textContent = timeString;
    }

    // Open extension guide
    function openExtensionGuide() {
      alert('Guide d\'installation de l\'extension Chrome GabaritKDP Tracker Ã  venir !');
    }

    // Show error
    function showError(message) {
      console.error(message);
    }

    // Language switcher
    function switchLanguage(lang) {
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang') === lang) {
          btn.classList.add('active');
        }
      });

      document.querySelectorAll('[data-fr][data-en]').forEach(el => {
        el.textContent = lang === 'fr' ? el.getAttribute('data-fr') : el.getAttribute('data-en');
      });

      document.querySelectorAll('[data-fr-placeholder][data-en-placeholder]').forEach(el => {
        el.placeholder = lang === 'fr' ? el.getAttribute('data-fr-placeholder') : el.getAttribute('data-en-placeholder');
      });
    }

    // Update coaching section based on performance
    function updateCoachingSection() {
      const activeBooks = parseInt(document.getElementById('activeBooks')?.textContent || '0');
      const totalRevenue = parseFloat(document.getElementById('totalRevenue')?.textContent.replace(/[^0-9.]/g, '') || '0');
      
      // Update goal progress
      const goal = 10;
      const progress = Math.min((activeBooks / goal) * 100, 100);
      document.getElementById('goalProgress').textContent = `${activeBooks}/${goal}`;
      document.getElementById('goalFill').style.width = `${progress}%`;
      
      const remaining = Math.max(goal - activeBooks, 0);
      const goalMessageEl = document.getElementById('goalMessage');
      if (remaining === 0) {
        goalMessageEl.innerHTML = '<span>ðŸŽ‰ Objectif atteint ! Tu es un champion ! ðŸ†</span>';
      } else {
        goalMessageEl.innerHTML = `<span>Tu es Ã  ${remaining} livre${remaining > 1 ? 's' : ''} de ton objectif ! ðŸŽ¯</span>`;
      }

      // Calculate potential revenue
      const avgRevenuePerBook = activeBooks > 0 ? totalRevenue / activeBooks : 90;
      const potentialRevenue = Math.round(avgRevenuePerBook);
      document.getElementById('potentialRevenue').textContent = `+â‚¬${potentialRevenue}`;

      // Personalized coaching messages based on performance
      const coachingTitle = document.getElementById('coachingTitle');
      const coachingMessage = document.getElementById('coachingMessage');

      if (activeBooks === 0) {
        // DÃ©butant - aucun livre
        coachingTitle.innerHTML = 'ðŸš€ Lance-Toi et Publie Ton Premier Livre !';
        coachingMessage.innerHTML = 'Ton aventure commence maintenant ! Chaque auteur Ã  succÃ¨s a commencÃ© exactement oÃ¹ tu es. Le premier livre est le plus difficile, mais aussi le plus excitant. PrÃªt Ã  construire ton empire du livre ?';
      } else if (activeBooks >= 1 && activeBooks < 3) {
        // DÃ©butant avancÃ© - 1-2 livres
        coachingTitle.innerHTML = 'ðŸ”¥ Excellent DÃ©but ! Publie Ton Prochain Bestseller !';
        coachingMessage.innerHTML = `Tu as ${activeBooks} livre${activeBooks > 1 ? 's' : ''} publiÃ©${activeBooks > 1 ? 's' : ''} - c'est gÃ©nial ! Les 3 premiers livres sont les plus importants. Publie ton prochain livre maintenant et tu verras tes revenus dÃ©coller ðŸ“ˆ`;
      } else if (activeBooks >= 3 && activeBooks < 5) {
        // IntermÃ©diaire - 3-4 livres
        coachingTitle.innerHTML = 'ðŸ’ª Tu Construis Ton Empire ! Continue l\'Expansion !';
        coachingMessage.innerHTML = `${activeBooks} livres actifs ! Tu commences Ã  bÃ¢tir un vÃ©ritable catalogue. Chaque nouveau livre amplifie tes revenus. Publie ton prochain livre et continue de bÃ¢tir ton empire !`;
      } else if (activeBooks >= 5 && activeBooks < 10) {
        // AvancÃ© - 5-9 livres
        coachingTitle.innerHTML = 'âš¡ Tu Deviens un Pro ! Publie Ton Prochain Hit !';
        coachingMessage.innerHTML = `Impressionnant ! ${activeBooks} livres en catalogue. Tu fais partie du top 20% des auteurs KDP. Ton prochain livre te rapprochera encore plus de l'objectif des 10 livres actifs !`;
      } else if (activeBooks >= 10 && activeBooks < 20) {
        // Expert - 10-19 livres
        coachingTitle.innerHTML = 'ðŸ† Champion ! Publie Ton Prochain Bestseller !';
        coachingMessage.innerHTML = `${activeBooks} livres actifs ! Tu es maintenant dans le top 10% des auteurs. Ton empire prend forme. Ton prochain livre va consolider ton succÃ¨s - vise maintenant les 20 livres pour des revenus vraiment passifs !`;
      } else {
        // Master - 20+ livres
        coachingTitle.innerHTML = 'ðŸ‘‘ LÃ©gende du KDP ! Continue d\'Innover !';
        coachingMessage.innerHTML = `${activeBooks} livres ! Tu as construit un vÃ©ritable empire du livre. Ton prochain livre va encore Ã©largir ton catalogue. Continue Ã  diversifier et Ã  optimiser tes meilleures niches. Le ciel est la limite !`;
      }

      // Add revenue-based motivation
      if (totalRevenue > 0 && totalRevenue < 100) {
        coachingMessage.innerHTML += '<br><br>ðŸ’¡ <strong>Astuce Pro :</strong> Tes premiers â‚¬100/mois sont les plus difficiles. AprÃ¨s, Ã§a devient exponentiel !';
      } else if (totalRevenue >= 100 && totalRevenue < 500) {
        coachingMessage.innerHTML += '<br><br>ðŸ’° <strong>Super !</strong> Tu gÃ©nÃ¨res dÃ©jÃ  des revenus rÃ©guliers. Continue Ã  publier pour atteindre les â‚¬500/mois !';
      } else if (totalRevenue >= 500 && totalRevenue < 1000) {
        coachingMessage.innerHTML += '<br><br>ðŸ”¥ <strong>Incroyable !</strong> â‚¬500+/mois de revenus passifs ! Tu es sur la bonne voie vers les â‚¬1000/mois !';
      } else if (totalRevenue >= 1000) {
        coachingMessage.innerHTML += '<br><br>ðŸ‘‘ <strong>CHAMPION !</strong> Tu as atteint les â‚¬1000/mois ! Tu fais partie de l\'Ã©lite des auteurs KDP !';
      }

      // Update niche cards click handlers
      document.querySelectorAll('.niche-card-mini').forEach(card => {
        card.addEventListener('click', () => {
          window.location.href = 'marketplace.html';
        });
      });

      // Trigger mascotte celebration if revenue increased
      if (totalRevenue > 100) {
        celebrateMascotte();
      }
    }

    // Load Amazon Best-Sellers
    async function loadBestSellers(category) {
      console.log('Loading best-sellers for category:', category);
      
      // Update active tab
      document.querySelectorAll('.category-tab').forEach(btn => {
        btn.classList.remove('active');
      });
      event?.target?.classList.add('active');

      const grid = document.getElementById('bestsellersGrid');
      grid.innerHTML = '<div class="loading"><div class="spinner"></div><span>Chargement des best-sellers...</span></div>';

      try {
        // TODO: Remplacer par appel API Amazon rÃ©el
        // const response = await fetch(`/.netlify/functions/amazon-bestsellers?category=${category}`);
        // const data = await response.json();

        // Demo data pour l'instant
        const demoData = getBestSellersDemo(category);
        
        setTimeout(() => {
          renderBestSellers(demoData);
        }, 500);

      } catch (error) {
        console.error('Error loading best-sellers:', error);
        grid.innerHTML = '<div class="error">Erreur de chargement. RÃ©essayez plus tard.</div>';
      }
    }

    // Demo data generator
    function getBestSellersDemo(category) {
      const categories = {
        'planners': [
          { title: '2025 Daily Planner', bsr: 12450, price: 10.99, rank: 1 },
          { title: 'Weekly Goal Planner', bsr: 18200, price: 9.99, rank: 2 },
          { title: 'Monthly Budget Planner', bsr: 25600, price: 11.99, rank: 3 },
          { title: 'Student Academic Planner', bsr: 32400, price: 10.99, rank: 4 }
        ],
        'journals': [
          { title: 'Gratitude Journal Daily', bsr: 15800, price: 9.99, rank: 1 },
          { title: 'Mindfulness Journal', bsr: 22400, price: 10.99, rank: 2 },
          { title: 'Dream Journal', bsr: 28900, price: 8.99, rank: 3 },
          { title: 'Travel Journal', bsr: 35600, price: 12.99, rank: 4 }
        ],
        'coloring': [
          { title: 'Adult Coloring Book - Mandalas', bsr: 18500, price: 8.99, rank: 1 },
          { title: 'Stress Relief Coloring', bsr: 24200, price: 7.99, rank: 2 },
          { title: 'Nature Scenes Coloring', bsr: 31800, price: 9.99, rank: 3 },
          { title: 'Animals Coloring Book', bsr: 38400, price: 8.99, rank: 4 }
        ],
        'notebooks': [
          { title: 'Lined Notebook Classic', bsr: 22300, price: 7.99, rank: 1 },
          { title: 'Dotted Journal', bsr: 28700, price: 8.99, rank: 2 },
          { title: 'Composition Notebook', bsr: 35200, price: 6.99, rank: 3 },
          { title: 'Blank Sketchbook', bsr: 42100, price: 9.99, rank: 4 }
        ]
      };

      return categories[category] || categories['planners'];
    }

    // Render best-sellers
    function renderBestSellers(books) {
      const grid = document.getElementById('bestsellersGrid');
      
      const html = books.map(book => {
        const sales = estimateMonthlySales(book.bsr);
        const revenue = Math.round(sales * book.price * 0.35);
        const badge = book.rank === 1 ? 'ðŸ† #1' : book.rank === 2 ? 'ðŸ¥ˆ #2' : book.rank === 3 ? 'ðŸ¥‰ #3' : `#${book.rank}`;
        const salesClass = sales > 100 ? 'green' : sales > 60 ? 'orange' : 'red';

        return `
          <div class="bestseller-card">
            <div class="bestseller-badge">${badge}</div>
            <div class="bestseller-image">
              <div class="placeholder-image">${getEmoji(book.title)}</div>
            </div>
            <h4 class="bestseller-title">${book.title}</h4>
            <div class="bestseller-stats">
              <span class="stat-item"><strong>BSR:</strong> ~${book.bsr.toLocaleString()}</span>
              <span class="stat-item"><strong>Prix:</strong> $${book.price}</span>
              <span class="stat-item ${salesClass}"><strong>~${sales}</strong> ventes/mois</span>
            </div>
            <div class="revenue-estimate">â‰ˆ â‚¬${revenue}/mois potentiel</div>
          </div>
        `;
      }).join('');

      grid.innerHTML = html;
    }

    // Estimate monthly sales from BSR
    function estimateMonthlySales(bsr) {
      if (bsr < 5000) return 200;
      if (bsr < 10000) return 150;
      if (bsr < 20000) return 120;
      if (bsr < 30000) return 90;
      if (bsr < 50000) return 60;
      return 30;
    }

    // Get emoji for book type
    function getEmoji(title) {
      if (title.includes('Planner')) return 'ðŸ“”';
      if (title.includes('Journal')) return 'ðŸ““';
      if (title.includes('Coloring')) return 'ðŸŽ¨';
      if (title.includes('Notebook')) return 'ðŸ“’';
      return 'ðŸ“–';
    }

    // Mascotte celebration animation
    function celebrateMascotte() {
      const mascotte = document.getElementById('mascotteImg');
      const bubble = document.getElementById('mascotteBubble');
      
      if (!mascotte || !bubble) return;

      const messages = [
        'ðŸ’° Tes ventes explosent !',
        'ðŸŽ‰ Bravo champion !',
        'ðŸš€ Tu cartonnes !',
        'â­ Excellent travail !',
        'ðŸ”¥ Continue comme Ã§a !'
      ];

      bubble.textContent = messages[Math.floor(Math.random() * messages.length)];
    }

    // Copy hashtag to clipboard
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('hashtag')) {
        const text = e.target.textContent;
        navigator.clipboard.writeText(text).then(() => {
          const original = e.target.textContent;
          e.target.textContent = 'âœ“ CopiÃ© !';
          setTimeout(() => {
            e.target.textContent = original;
          }, 1500);
        });
      }
    });
  
// ============================================
// JAVASCRIPT SECTION NICHES AVANCÃ‰E V4
// ============================================

// DonnÃ©es niches mockÃ©es Phase 1
const nichesAdvancedData = [
  { emoji: 'ðŸ“”', name: 'Planners 2025', market: 'USA', type: 'Planner', demand: 85, competition: 65, bsr: 15000, isLowComp: false },
  { emoji: 'ðŸŽ¨', name: 'Dog Coloring Books', market: 'USA', type: 'Coloring book', demand: 78, competition: 45, bsr: 28000, isLowComp: true },
  { emoji: 'ðŸ““', name: 'Gratitude Journals', market: 'USA', type: 'Journal', demand: 82, competition: 70, bsr: 22000, isLowComp: false },
  { emoji: 'ðŸŒ¸', name: 'Floral Activity Books', market: 'USA', type: 'Activity book', demand: 65, competition: 35, bsr: 45000, isLowComp: true },
  { emoji: 'ðŸ“–', name: 'Bullet Journals', market: 'USA', type: 'Journal', demand: 88, competition: 75, bsr: 18000, isLowComp: false },
  { emoji: 'ðŸŽ¯', name: 'Goal Setting Planners', market: 'USA', type: 'Planner', demand: 75, competition: 55, bsr: 32000, isLowComp: false },
  { emoji: 'ðŸ±', name: 'Cat Coloring Books', market: 'USA', type: 'Coloring book', demand: 72, competition: 40, bsr: 35000, isLowComp: true },
  { emoji: 'âœï¸', name: 'Writing Journals', market: 'USA', type: 'Journal', demand: 68, competition: 50, bsr: 38000, isLowComp: false },
  { emoji: 'ðŸŒº', name: 'Mandala Coloring', market: 'USA', type: 'Coloring book', demand: 80, competition: 60, bsr: 25000, isLowComp: false },
  { emoji: 'ðŸ“…', name: 'Daily Planners', market: 'USA', type: 'Planner', demand: 90, competition: 80, bsr: 12000, isLowComp: false },
  { emoji: 'ðŸ“”', name: 'Planners 2025', market: 'France', type: 'Planner', demand: 70, competition: 45, bsr: 35000, isLowComp: true },
  { emoji: 'ðŸŽ¨', name: 'Coloriages Adultes', market: 'France', type: 'Coloring book', demand: 75, competition: 50, bsr: 28000, isLowComp: false },
  { emoji: 'ðŸ““', name: 'Carnets de Gratitude', market: 'France', type: 'Journal', demand: 65, competition: 35, bsr: 42000, isLowComp: true },
  { emoji: 'ðŸ“–', name: 'Bullet Journals FR', market: 'France', type: 'Journal', demand: 72, competition: 55, bsr: 32000, isLowComp: false },
  { emoji: 'ðŸŒ¸', name: 'Coloriages Fleurs', market: 'France', type: 'Coloring book', demand: 68, competition: 40, bsr: 38000, isLowComp: true },
  { emoji: 'ðŸ“š', name: 'Romance Contemporaine', market: 'France', type: 'Roman', demand: 85, competition: 75, bsr: 18000, isLowComp: false },
  { emoji: 'ðŸ”®', name: 'Fantasy Romance', market: 'France', type: 'Roman', demand: 78, competition: 60, bsr: 25000, isLowComp: false },
  { emoji: 'ðŸ’¼', name: 'DÃ©veloppement Personnel', market: 'France', type: 'Non-fiction', demand: 80, competition: 65, bsr: 22000, isLowComp: false },
  { emoji: 'ðŸŽ¯', name: 'Objectifs & Motivation', market: 'France', type: 'Non-fiction', demand: 70, competition: 45, bsr: 35000, isLowComp: true },
  { emoji: 'ðŸŒŸ', name: 'Kids Story Books', market: 'USA', type: 'Activity book', demand: 82, competition: 70, bsr: 20000, isLowComp: false }
];

// Calcul score de niche
function calculateNicheScoreAdvanced(demand, competition, bsr) {
  const demandScore = Math.min(Math.max(demand, 0), 100);
  const competitionScore = 100 - Math.min(Math.max(competition, 0), 100);
  const bsrNormalized = Math.max(10000, Math.min(bsr, 1000000));
  const bsrScore = 100 - ((bsrNormalized - 10000) / (1000000 - 10000)) * 100;
  const score = (0.4 * demandScore) + (0.3 * competitionScore) + (0.3 * bsrScore);
  return Math.round(Math.min(Math.max(score, 0), 100));
}

// Afficher niches
function displayNichesAdvanced(nichesToDisplay) {
  const tbody = document.getElementById('nichesBodyAdvanced');
  if (!tbody) return;
  
  tbody.innerHTML = '';

  nichesToDisplay.forEach(niche => {
    const score = calculateNicheScoreAdvanced(niche.demand, niche.competition, niche.bsr);
    
    let scoreClass = 'color: #c0392b;';
    let statusBadge = '<span style="display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; background: linear-gradient(135deg, #ff6b6b, #ee5a6f); color: white;">âš ï¸ SaturÃ©</span>';
    
    if (score >= 70) {
      scoreClass = 'color: #0c8f3a;';
      statusBadge = '<span style="display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; background: linear-gradient(135deg, #ff6b6b, #ee5a6f); color: white;">ðŸ”¥ OpportunitÃ©</span>';
    } else if (score >= 40) {
      scoreClass = 'color: #e6a700;';
      statusBadge = '<span style="display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; background: linear-gradient(135deg, #51cf66, #37b24d); color: white;">ðŸ’¡ Ã€ Creuser</span>';
    }

    let extraBadges = '';
    if (score >= 80) {
      extraBadges += '<span style="display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; margin-left: 8px;">ðŸ”¥ Tendance</span>';
    }
    if (niche.isLowComp) {
      extraBadges += '<span style="display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; background: linear-gradient(135deg, #06b6d4, #0891b2); color: white; margin-left: 8px;">ðŸŒ± Faible Concurrence</span>';
    }
    if (niche.demand >= 80 && niche.competition <= 50) {
      extraBadges += '<span style="display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; background: linear-gradient(135deg, #ec4899, #db2777); color: white; margin-left: 8px;">ðŸ’Ž PÃ©pite</span>';
    }

    const row = document.createElement('tr');
    row.style.transition = 'all 0.3s';
    row.onmouseover = function() { this.style.background = 'rgba(255,153,0,0.05)'; };
    row.onmouseout = function() { this.style.background = ''; };
    
    row.innerHTML = `
      <td style="padding: 18px 20px; border-bottom: 1px solid var(--border); font-size: 15px;">
        <div style="font-weight: 600; font-size: 16px; color: var(--text-primary);">
          <span style="font-size: 24px; margin-right: 8px;">${niche.emoji}</span>
          ${niche.name}
        </div>
      </td>
      <td style="padding: 18px 20px; border-bottom: 1px solid var(--border); font-size: 15px;">${niche.market === 'USA' ? 'ðŸ‡ºðŸ‡¸ USA' : 'ðŸ‡«ðŸ‡· France'}</td>
      <td style="padding: 18px 20px; border-bottom: 1px solid var(--border); font-size: 15px;">${niche.type}</td>
      <td style="padding: 18px 20px; border-bottom: 1px solid var(--border); font-size: 15px;">${niche.demand >= 75 ? 'Ã‰levÃ©e' : niche.demand >= 50 ? 'Moyenne' : 'Faible'}</td>
      <td style="padding: 18px 20px; border-bottom: 1px solid var(--border); font-size: 15px;">${niche.competition >= 70 ? 'Forte' : niche.competition >= 40 ? 'Moyenne' : 'Faible'}</td>
      <td style="padding: 18px 20px; border-bottom: 1px solid var(--border); font-size: 15px;">${niche.bsr.toLocaleString()}</td>
      <td style="padding: 18px 20px; border-bottom: 1px solid var(--border); font-size: 15px; text-align: center; font-weight: 700; font-size: 18px; ${scoreClass}">${score}/100</td>
      <td style="padding: 18px 20px; border-bottom: 1px solid var(--border); font-size: 15px;">
        ${statusBadge}
        ${extraBadges}
      </td>
    `;
    tbody.appendChild(row);
  });

  updateMotivationalMessageAdvanced(nichesToDisplay.length);
}

// Message motivant
function updateMotivationalMessageAdvanced(count) {
  const msgDiv = document.getElementById('motivationalMsgAdvanced');
  if (!msgDiv) return;
  
  if (count === 0) {
    msgDiv.innerHTML = 'ðŸ” <strong>Aucune niche trouvÃ©e avec ces critÃ¨res.</strong> Ajuste un peu tes filtres : la bonne niche n\'est jamais loin quand tu continues d\'explorer.';
  } else if (count >= 10) {
    msgDiv.innerHTML = 'ðŸŽ‰ <strong>Bien jouÃ©, tu viens de faire ressortir les niches les plus prometteuses.</strong> Tu n\'as pas besoin de toutes les exploiter. Une seule peut dÃ©jÃ  faire une Ã©norme diffÃ©rence.';
  } else if (count <= 5) {
    msgDiv.innerHTML = 'ðŸ’Ž <strong>Peu de rÃ©sultats, c\'est souvent peu de concurrence.</strong> Si une niche te parle, tu peux devenir la rÃ©fÃ©rence sur ce sujet.';
  } else {
    msgDiv.innerHTML = 'ðŸ’¡ <strong>Chaque ligne est une opportunitÃ©.</strong> Ta mission : repÃ©rer celles qui te donnent envie de crÃ©erâ€¦ et ne plus les laisser dormir dans un tableau.';
  }
}

// Filtres
function applyNichesFilters() {
  const marketEl = document.getElementById('filterMarketAdvanced');
  const typeEl = document.getElementById('filterTypeAdvanced');
  const scoreEl = document.getElementById('filterScoreAdvanced');
  const lowCompEl = document.getElementById('filterLowCompAdvanced');
  
  if (!marketEl || !typeEl || !scoreEl || !lowCompEl) return;
  
  const market = marketEl.value;
  const type = typeEl.value;
  const minScore = parseInt(scoreEl.value) || 0;
  const lowCompOnly = lowCompEl.checked;

  let filtered = nichesAdvancedData.filter(niche => {
    const score = calculateNicheScoreAdvanced(niche.demand, niche.competition, niche.bsr);
    
    if (market && niche.market !== market) return false;
    if (type && niche.type !== type) return false;
    if (score < minScore) return false;
    if (lowCompOnly && !niche.isLowComp) return false;
    
    return true;
  });

  displayNichesAdvanced(filtered);
  updateFilterStatsAdvanced(filtered.length, nichesAdvancedData.length);
}

// Stats filtres
function updateFilterStatsAdvanced(shown, total) {
  const statsDiv = document.getElementById('filterStatsAdvanced');
  if (!statsDiv) return;
  
  if (shown === total) {
    statsDiv.innerHTML = `ðŸ“Š Toutes les ${total} niches affichÃ©es`;
  } else {
    statsDiv.innerHTML = `âœ… ${shown} niche${shown > 1 ? 's' : ''} trouvÃ©e${shown > 1 ? 's' : ''} sur ${total}`;
  }
}

// Init au chargement
document.addEventListener('DOMContentLoaded', function() {
  // Attendre que le DOM soit prÃªt
  setTimeout(() => {
    if (document.getElementById('nichesBodyAdvanced')) {
      displayNichesAdvanced(nichesAdvancedData);
      updateFilterStatsAdvanced(nichesAdvancedData.length, nichesAdvancedData.length);
    }
  }, 100);
});

  </script>
</body>
</html>
